/*
 * @author electricessence / https://github.com/electricessence/
 * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md
 * Based on: https://en.wikipedia.org/wiki/Uniform_Resource_Identifier
 */
define(["require","exports","../Types","./Scheme","../Exceptions/ArgumentException","../Exceptions/ArgumentOutOfRangeException","./QueryParams"],function(t,e,r,n,o,i,u){function s(t){return t.replace(/^\s+|\s+$/g,w)}function f(t){var e=t;if(r.isString(e)){if(!e)return void 0;if(e=n[s(e).toLowerCase().replace(/[^a-z0-9+.-]+$/g,w)],isNaN(e))throw new i("scheme",t,"Invalid scheme.")}if(r.isNumber(e,!1)){if(e=n[e],!e)throw new i("scheme",t,"Invalid scheme.");return e}return void 0}function a(t){if(!t.host){if(t.userInfo)throw new o("host","Cannot include user info when there is no host.");if(!isNaN(t.port))throw new o("host","Cannot include a port when there is no host.")}var e=t.host||w;return e&&(t.userInfo&&(e=t.userInfo+x+e),isNaN(t.port)||(e+=":"+t.port),e=d+e),e}function h(t){return t&&(-1==t.indexOf(b)?b:w)+t}function p(t){return t&&(-1==t.indexOf(v)?v:w)+t}function c(t){var e=t.path,r=t.query;return w+(e&&(-1==e.indexOf(y)?y:w)+e||w)+(h(r)||w)}function g(t){var e=f(t.scheme),r=a(t),n=c(t),o=p(t.fragment);return w+(e&&e+":"||w)+(r||w)+(n||w)+(o||w)}function l(t){if(!t)throw new o("url","Nothing to parse.");var e,r={};if(e=t.indexOf(v),-1!=e&&(r.fragment=t.substring(e),t=t.substring(0,e)),e=t.indexOf(b),-1!=e&&(r.query=t.substring(e),t=t.substring(0,e)),e=t.indexOf(d),-1!=e){var n=s(t.substring(0,e)),i=/:$/;if(!i.test(n))throw new o("url","Scheme was improperly formatted");n=s(n.replace(i,w)),r.scheme=n||void 0,t=t.substring(e+2)}if(e=t.indexOf(y),-1!=e&&(r.path=t.substring(e)||void 0,t=t.substring(0,e)),e=t.indexOf(x),-1!=e&&(r.userInfo=t.substring(0,e)||void 0,t=t.substring(e+1)),e=t.indexOf(":"),-1!=e){var u=parseInt(s(t.substring(e+1)));if(isNaN(u))throw new o("url","Port was invalid.");r.port=u,t=t.substring(0,e)}return r.host=s(t)||void 0,r}var m=function(){function t(t,e,n,o,i,s,a){var c=this;c.scheme=f(t)||null,c.userInfo=e||null,c.host=n||null,c.port=o,c.path=i||null,r.isString(s)||(s=u.encode(s)),c.query=h(s)||null,c.fragment=p(a)||null,c.absoluteUri=c.getAbsoluteUri(),c.authority=c.getAuthority()||null,c.pathAndQuery=c.getPathAndQuery()||null,Object.freeze(c.queryParams=c.query?u.parseToMap(c.query):{}),Object.freeze(c)}return t.prototype.equals=function(e){return this.absoluteUri==t.toString(e)},t.from=function(e){var n=!e||r.isString(e)?l(e):e;return new t(n.scheme,n.userInfo,n.host,n.port,n.path,n.query,n.fragment)},t.parse=function(t){return l(t)},t.prototype.copyTo=function(t){var e=this;return e.scheme&&(t.scheme=e.scheme),e.userInfo&&(t.userInfo=e.userInfo),e.host&&(t.host=e.host),e.port&&(t.port=e.port),e.path&&(t.path=e.path),e.query&&(t.query=e.query),e.fragment&&(t.fragment=e.fragment),t},t.prototype.getAbsoluteUri=function(){return g(this)},t.prototype.getAuthority=function(){return a(this)},t.prototype.getPathAndQuery=function(){return c(this)},Object.defineProperty(t.prototype,"pathSegments",{get:function(){return this.path.match(/^[\/]|[^\/]*[\/]|[^\/]+$/g)},enumerable:!0,configurable:!0}),t.prototype.toMap=function(){return this.copyTo({})},t.prototype.toString=function(){return this.absoluteUri},t.toString=function(e){return e instanceof t?e.absoluteUri:g(e)},t.getAuthority=function(t){return a(t)},t}(),y="/",d="//",b="?",v="#",w="",x="@";return m});
//# sourceMappingURL=Uri.js.map
