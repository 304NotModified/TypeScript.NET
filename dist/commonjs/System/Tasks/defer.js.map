{"version":3,"sources":["System/Tasks/defer.js","System/Tasks/defer.ts"],"names":[],"mappings":";;;;AAIA;;;;;;;;;;ICIA;;;;;;;kCAOQ;AAEN,iBAAK,MAAL,GAFM;;;;WAPR;;;IAaA;;;AAIC,aAJD,KAIC,CAAY,IAAZ,EAA0B,KAA1B,EAAuC;8BAJxC,OAIwC;;2EAJxC,mBAIwC;;AAGtC,YAAG,EAAE,QAAM,CAAN,CAAF,EAAY,QAAQ,CAAR,CAAf;AACA,cAAK,GAAL,GAAW,WAAW,MAAM,OAAN,EAAe,KAA1B,EAAiC,IAAjC,QAAX,CAJsC;;KAAvC;;iBAJD;;iCAWO;AAEL,gBAAI,KAAK,KAAK,GAAL,CAFJ;AAGL,gBAAG,EAAH,EACA;AACC,6BAAa,EAAb,EADD;AAEC,qBAAK,GAAL,GAAW,IAAX,CAFD;AAGC,uBAAO,IAAP,CAHD;aADA;AAMA,mBAAO,KAAP,CATK;;;;gCAaiB,MAAe,GAAO;AAE5C,cAAE,MAAF,GAF4C;AAG5C,mBAH4C;;;;WAxB9C;EAAoB;;IAgCpB;;;AAIC,aAJD,aAIC,CACC,IADD,EAEC,QAFD,EAGqC;YAA5B,mEAAoB,wBAAQ;;8BAPtC,eAOsC;;4EAPtC,2BAOsC;;AAA5B,eAAA,UAAA,GAAA,UAAA,CAA4B;AAGpC,YAAG,aAAW,IAAX,IAAmB,aAAY,KAAK,CAAL,EACjC,MAAM,oCAAN,CADD;AAEA,YAAG,WAAS,CAAT,EACF,MAAM,gCAAN,CADD;AAGA,eAAK,GAAL,GAAW,YAAY,cAAc,OAAd,EAAuB,QAAnC,EAA6C,IAA7C,SAAX,CARoC;;KAHrC;;iBAJD;;iCAkBO;AAEL,gBAAI,KAAK,KAAK,GAAL,CAFJ;AAGL,gBAAG,EAAH,EACA;AACC,8BAAc,EAAd,EADD;AAEC,qBAAK,GAAL,GAAW,IAAX,CAFD;AAGC,uBAAO,IAAP,CAHD;aADA;AAMA,mBAAO,KAAP,CATK;;;;gCAYiB,MAAe,GAAe;AAEpD,gBAAG,EAAE,EAAE,EAAE,UAAF,EAAe,EAAE,MAAF,GAAtB;AACA,mBAHoD;;;;WA9BtD;EAA4B;;AAuC5B,SAAA,KAAA,CACC,IADD,EAEC,KAFD,EAEc;AAEb,WAAO,IAAI,KAAJ,CAAU,IAAV,EAAgB,KAAhB,CAAP,CAFa;CAFd;AAAgB,QAAA,KAAA,GAAK,KAAL;AAOhB,SAAA,QAAA,CACC,IADD,EAEC,QAFD,EAGwB;QAAvB,8DAAe,wBAAQ;;AAEvB,WAAO,IAAI,aAAJ,CAAkB,IAAlB,EAAwB,QAAxB,EAAkC,KAAlC,CAAP,CAFuB;CAHxB;AAAgB,QAAA,QAAA,GAAQ,QAAR;AAQhB,OAAA,cAAA,CAAA,OAAA,EAAA,YAAA,EAAA,EAAA,OAAA,IAAA,EAAA;AD1CA,QAAQ,OAAR,GC0Ce,KD1Cf","file":"System/Tasks/defer.js","sourcesContent":["/*!\n * @author electricessence / https://github.com/electricessence/\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\n */\n\"use strict\";\nclass DeferBase {\n    dispose() {\n        this.cancel();\n    }\n}\nclass Defer extends DeferBase {\n    constructor(task, delay) {\n        super();\n        if (!(delay > 0))\n            delay = 0;\n        this._id = setTimeout(Defer.handler, delay, task, this);\n    }\n    cancel() {\n        var id = this._id;\n        if (id) {\n            clearTimeout(id);\n            this._id = null;\n            return true;\n        }\n        return false;\n    }\n    static handler(task, d) {\n        d.cancel();\n        task();\n    }\n}\nclass DeferInterval extends DeferBase {\n    constructor(task, interval, _remaining = Infinity) {\n        super();\n        this._remaining = _remaining;\n        if (interval === null || interval === void (0))\n            throw \"'interval' must be a valid number.\";\n        if (interval < 0)\n            throw \"'interval' cannot be negative.\";\n        this._id = setInterval(DeferInterval.handler, interval, task, this);\n    }\n    cancel() {\n        var id = this._id;\n        if (id) {\n            clearInterval(id);\n            this._id = null;\n            return true;\n        }\n        return false;\n    }\n    static handler(task, d) {\n        if (!(--d._remaining))\n            d.cancel();\n        task();\n    }\n}\nfunction defer(task, delay) {\n    return new Defer(task, delay);\n}\nexports.defer = defer;\nfunction interval(task, interval, count = Infinity) {\n    return new DeferInterval(task, interval, count);\n}\nexports.interval = interval;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.default = defer;\n","/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\n\r\nimport {ICancellable} from \"./ICancellable\";\r\nimport {Closure} from \"../FunctionTypes\";\r\nabstract class DeferBase implements ICancellable\r\n{\r\n\t// It may be a Timer in node, should not be restricted to number.\r\n\tprotected _id:any;\r\n\r\n\tabstract cancel():boolean;\r\n\r\n\tdispose():void\r\n\t{\r\n\t\tthis.cancel();\r\n\t}\r\n}\r\n\r\nclass Defer extends DeferBase\r\n{\r\n\r\n\r\n\tconstructor(task:Closure, delay?:number)\r\n\t{\r\n\t\tsuper();\r\n\t\tif(!(delay>0)) delay = 0; // covers undefined and null.\r\n\t\tthis._id = setTimeout(Defer.handler, delay, task, this);\r\n\t}\r\n\r\n\tcancel():boolean\r\n\t{\r\n\t\tvar id = this._id;\r\n\t\tif(id)\r\n\t\t{\r\n\t\t\tclearTimeout(id);\r\n\t\t\tthis._id = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t// Use a static function here to avoid recreating a new function every time.\r\n\tprivate static handler(task:Function, d:Defer):void\r\n\t{\r\n\t\td.cancel();\r\n\t\ttask();\r\n\t}\r\n\r\n}\r\n\r\nclass DeferInterval extends DeferBase\r\n{\r\n\r\n\r\n\tconstructor(\r\n\t\ttask:Function,\r\n\t\tinterval:number,\r\n\t\tprivate _remaining:number = Infinity)\r\n\t{\r\n\t\tsuper();\r\n\t\tif(interval===null || interval=== void(0))\r\n\t\t\tthrow \"'interval' must be a valid number.\";\r\n\t\tif(interval<0)\r\n\t\t\tthrow \"'interval' cannot be negative.\";\r\n\r\n\t\tthis._id = setInterval(DeferInterval.handler, interval, task, this);\r\n\t}\r\n\r\n\tcancel():boolean\r\n\t{\r\n\t\tvar id = this._id;\r\n\t\tif(id)\r\n\t\t{\r\n\t\t\tclearInterval(id);\r\n\t\t\tthis._id = null;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate static handler(task:Function, d:DeferInterval):void\r\n\t{\r\n\t\tif(!(--d._remaining)) d.cancel();\r\n\t\ttask();\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport function defer(\r\n\ttask:Closure,\r\n\tdelay?:number):ICancellable\r\n{\r\n\treturn new Defer(task, delay);\r\n}\r\n\r\nexport function interval(\r\n\ttask:Function,\r\n\tinterval:number,\r\n\tcount:number = Infinity):ICancellable\r\n{\r\n\treturn new DeferInterval(task, interval, count);\r\n}\r\n\r\nexport default defer;"]}