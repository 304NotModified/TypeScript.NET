{"version":3,"sources":["System/Events/EventDispatcher.ts"],"names":["EventDispatcherEntry","EventDispatcherEntry.constructor","EventDispatcherEntry.dispose","EventDispatcherEntry.matches","EventDispatcherEntry.equals","EventDispatcherEntry.wasDisposed","EventDispatcher","EventDispatcher.constructor","EventDispatcher.addEventListener","EventDispatcher.registerEventListener","EventDispatcher.hasEventListener","EventDispatcher.removeEventListener","EventDispatcher.dispatchEvent","EventDispatcher.dispose","EventDispatcher.isDisposing","EventDispatcher.DISPOSING","EventDispatcher.DISPOSED"],"mappings":"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","file":"System/Events/EventDispatcher.js","sourcesContent":["/*\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\n///<reference path=\"../Disposable/IDisposable.d.ts\"/>\r\n///<reference path=\"IEventDispatcher.d.ts\"/>\r\n\r\nimport shallowCopy from '../Utility/shallowCopy';\r\nimport DisposableBase from '../Disposable/DisposableBase';\r\nimport * as AU from '../Collections/Array/Utility';\r\n\r\n\r\nexport default\r\nclass EventDispatcherEntry extends DisposableBase\r\n{\r\n\r\n\tconstructor(\r\n\t\tpublic type:string,\r\n\t\tpublic listener:EventListener,\r\n\t\tpublic useCapture:boolean = false,\r\n\t\tpublic priority:number = 0)//, useWeakReference: boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\t\tvar _ = this;\r\n\t\t_.type = type;\r\n\t\t_.listener = listener;\r\n\t\t_.useCapture = useCapture;\r\n\t\t_.priority = priority;\r\n\t\t// _.useWeakReference = useWeakReference;\r\n\t}\r\n\r\n\t// useWeakReference: boolean;\r\n\r\n\tdispose():void {\r\n\t\tthis.listener = null;\r\n\t}\r\n\r\n\tget wasDisposed():boolean {\r\n\t\treturn this.listener==null;\r\n\t}\r\n\r\n\tmatches(type:string, listener:EventListener, useCapture:boolean = false):boolean {\r\n\t\tvar _ = this;\r\n\t\treturn _.type==type\r\n\t\t       && _.listener==listener\r\n\t\t       && _.useCapture==useCapture;\r\n\t}\r\n\r\n\tequals(other:EventDispatcherEntry):boolean {\r\n\t\tvar _ = this;\r\n\t\treturn _.type==other.type\r\n\t\t       && _.listener==other.listener\r\n\t\t       && _.useCapture==other.useCapture\r\n\t\t       && _.priority==other.priority\r\n\t\t\t// && this.useWeakReference == other.useWeakReference\r\n\t\t\t;\r\n\t}\r\n}\r\n\r\nclass EventDispatcher extends DisposableBase implements IEventDispatcher\r\n{\r\n\r\n\tprivate _listeners:EventDispatcherEntry[];\r\n\r\n\taddEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:EventListener,\r\n\t\tuseCapture:boolean = false,\r\n\t\tpriority:number = 0):void//, useWeakReference: boolean= false)\r\n\t{\r\n\t\tvar l:EventDispatcherEntry[] = this._listeners;\r\n\t\tif(!l)\r\n\t\t\tthis._listeners = l = [];\r\n\r\n\t\t// flash/vibe.js means of adding is indiscriminate and will double add listeners...\r\n\t\t// we can then avoid double adds by including a 'registerEventListener' method.\r\n\t\tl.push(new EventDispatcherEntry(type, listener, useCapture, priority));//, useWeakReference));\r\n\t}\r\n\r\n\t// Allow for simple add once mechanism.\r\n\tregisterEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:EventListener,\r\n\t\tuseCapture:boolean = false,\r\n\t\tpriority:number = 0):void//, useWeakReference: boolean= false)\r\n\t{\r\n\t\tif(!this.hasEventListener(type, listener, useCapture))\r\n\t\t\tthis.addEventListener(type, listener, useCapture, priority);\r\n\t}\r\n\r\n\thasEventListener(type:string, listener?:EventListener, useCapture:boolean = false):boolean {\r\n\t\tvar l = this._listeners;\r\n\t\treturn l && l.some(\r\n\t\t\t\t(value:EventDispatcherEntry):boolean =>\r\n               type==value.type && (!listener || listener==value.listener && useCapture==value.useCapture)\r\n\t\t\t);\r\n\r\n\t}\r\n\r\n\tremoveEventListener(type:string, listener:EventListener, userCapture:boolean = false):void {\r\n\r\n\t\tvar l = this._listeners;\r\n\r\n\t\tif(l) {\r\n\t\t\tvar i = AU.findIndex(l, entry=> entry.matches(type, listener, userCapture));\r\n\t\t\tif(i!= -1) {\r\n\t\t\t\tvar e = l[i];\r\n\t\t\t\tl.splice(i, 1);\r\n\t\t\t\te.dispose();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdispatchEvent(type:string, params?:any):boolean;\r\n\tdispatchEvent(event:Event):boolean;\r\n\tdispatchEvent(e:any, params?:any):boolean {\r\n\r\n\t\tvar _ = this, l = _._listeners;\r\n\t\tif(!l || !l.length)\r\n\t\t\treturn false;\r\n\r\n\t\tvar event:Event;\r\n\r\n\t\tif(typeof e==\"string\") {\r\n\t\t\tevent = Object.create(Event);\r\n\t\t\tif(!params)\r\n\t\t\t\tparams = {};\r\n\t\t\tevent.cancelable = !!params.cancelable;\r\n\t\t\tevent.target = _;\r\n\t\t\tevent.type = e;\r\n\t\t}\r\n\t\telse\r\n\t\t\tevent = <Event>e;\r\n\r\n\t\tvar type = event.type;\r\n\r\n\t\t// noinspection JSMismatchedCollectionQueryUpdate\r\n\t\tvar entries:EventDispatcherEntry[] = [];//, propagate = true, prevent = false;\r\n\t\tl.forEach((e:EventDispatcherEntry):void => { if(e.type==type) entries.push(e); });\r\n\t\tif(!entries.length)\r\n\t\t\treturn false;\r\n\r\n\t\tentries.sort(function (a, b) { return b.priority - a.priority; });\r\n\r\n\t\t// For now... Just use simple...\r\n\t\tentries.forEach(\r\n\t\t\t\tentry=> {\r\n\t\t\t\tvar newEvent = Object.create(Event);\r\n\t\t\t\tshallowCopy(event, newEvent);\r\n\t\t\t\tnewEvent.target = this;\r\n\t\t\t\tentry.listener(newEvent);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tstatic get DISPOSING() { return \"disposing\"; }\r\n\r\n\tstatic get DISPOSED() { return \"disposed\"; }\r\n\r\n\t// When dispatching events, we need a way to prevent recursion when disposing.\r\n\tprivate _isDisposing:boolean = false;\r\n\tget isDisposing():boolean {\r\n\t\treturn this._isDisposing;\r\n\t}\r\n\r\n\t// Override the public method here since EventDispatcher will end up doing things a bit differently from here on.\r\n\tpublic dispose() {\r\n\r\n\t\t// Having a disposing event can allow for child objects to automatically release themselves when their parent is disposed.\r\n\t\tvar _ = this;\r\n\t\tif(!_.wasDisposed && !_._isDisposing) {\r\n\t\t\t_._isDisposing = true;\r\n\t\t\t_.dispatchEvent(EventDispatcher.DISPOSING);\r\n\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\t_.dispatchEvent(EventDispatcher.DISPOSED);\r\n\r\n\t\t\tvar l = _._listeners;\r\n\t\t\tif(l) {\r\n\t\t\t\tthis._listeners = null;\r\n\t\t\t\tl.forEach(e=> e.dispose());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\n"]}