{"version":3,"sources":["System/Collections/Enumeration/EnumeratorBase.js","System/Collections/Enumeration/EnumeratorBase.ts"],"names":["__extends","this","d","b","__","constructor","p","hasOwnProperty","prototype","Object","create","define","require","exports","DisposableBase_1","EnumeratorState","Yielder","get","Yielder.current","enumerable","configurable","Yielder.yieldReturn","Yielder.yieldBreak","EnumeratorBase","_super","EnumeratorBase.constructor","EnumeratorBase.current","EnumeratorBase.reset","EnumeratorBase.moveNext","EnumeratorBase._onDispose","defineProperty","value"],"mappings":";;;;AAIA,GAAIA,WAAaC,MAAQA,KAAKD,WAAc,SAAUE,EAAGC,GAErD,QAASC,KAAOH,KAAKI,YAAcH,EADnC,IAAK,GAAII,KAAKH,GAAOA,EAAEI,eAAeD,KAAIJ,EAAEI,GAAKH,EAAEG,GAEnDJ,GAAEM,UAAkB,OAANL,EAAaM,OAAOC,OAAOP,IAAMC,EAAGI,UAAYL,EAAEK,UAAW,GAAIJ,IAEnFO,SAAQ,UAAW,UAAW,mCAAoC,SAAUC,EAASC,EAASC,GCD9F,YAOA,IAiBKC,GAjBLC,EAAA,WAAAA,QAAAA,MAcAA,MAXCA,QAAAA,eAAIA,EAAAA,UAAAA,WDHOC,ICGXD,WAAkBE,MAAOA,MAAKA,UDFnBC,YAAY,EACZC,cAAc,ICGzBJ,EAAAA,UAAAA,YAAAA,SAAYA,GAEXK,MADAA,MAAKA,SAAWA,GACTA,GAGRL,EAAAA,UAAAA,WAAAA,WAECM,MADAA,MAAKA,SAAWA,MACTA,GAETN,MAGA,SAAKD,GAAkBA,EAAAA,EAAAA,OAAAA,GAAAA,SAAQA,EAAAA,EAAAA,QAAAA,GAAAA,UAASA,EAAAA,EAAAA,MAAAA,GAAAA,SAAnCA,IAAAA,MAGL,IAAAQ,GAAA,SAAAC,GAYCD,QAAAA,GACSA,EACAA,EACAA,GAERE,EAAAA,KAAAA,MAJQA,KAAAA,YAAAA,EACAA,KAAAA,WAAAA,EACAA,KAAAA,SAAAA,EAGRA,KAAKA,QA6DPF,MA9EgCA,WAAAA,EAAAA,GAM/BA,OAAAA,eAAIA,EAAAA,UAAAA,WDGON,ICHXM,WACCG,MAAOA,MAAKA,SAASA,SDKXP,YAAY,EACZC,cAAc,ICQzBG,EAAAA,UAAAA,MAAAA,WACCI,GAAIA,GAAIA,IACRA,GAAEA,SAAWA,GAAIA,GACjBA,EAAEA,OAASA,EAAgBA,QAG5BJ,EAAAA,UAAAA,SAAAA,WACCK,GAAIA,GAAIA,IACRA,KACCA,OAAOA,EAAEA,QACRA,IAAKA,GAAgBA,OACpBA,EAAEA,OAASA,EAAgBA,OAC3BA,IAAIA,GAAcA,EAAEA,WACjBA,IACFA,GAEFA,KAAKA,GAAgBA,QACpBA,MAAGA,GAAEA,WAAWA,EAAEA,WACVA,GAGPA,KAAKA,WACEA,EAETA,KAAKA,GAAgBA,MACpBA,OAAOA,GAGVA,MAAMA,GAELA,KADAA,MAAKA,UACCA,IAIEL,EAAAA,UAAAA,WAAVA,WACCM,GAAIA,GAAIA,KAAMA,EAAWA,EAAEA,QAE3BA,GAAEA,YAAcA,KAChBA,EAAEA,SAAWA,IAEbA,IAAIA,GAAUA,EAAEA,QAChBA,GAAEA,SAAWA,KACVA,GACFA,EAAQA,YAETA,KAEIA,GACFA,IDXQ,QCgBTA,KAAKA,OAASA,EAAgBA,QAIjCN,GA9EgCT,EAAAA,WADhCL,QAAAqB,eAAAjB,EAAA,cAAAkB,OAAA,IDkEIlB,EAAAA,WAAkBU","file":"System/Collections/Enumeration/EnumeratorBase.js","sourcesContent":["/*!\n * @author electricessence / https://github.com/electricessence/\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\n */\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\ndefine([\"require\", \"exports\", '../../Disposable/DisposableBase'], function (require, exports, DisposableBase_1) {\n    'use strict';\n    var Yielder = (function () {\n        function Yielder() {\n        }\n        Object.defineProperty(Yielder.prototype, \"current\", {\n            get: function () { return this._current; },\n            enumerable: true,\n            configurable: true\n        });\n        Yielder.prototype.yieldReturn = function (value) {\n            this._current = value;\n            return true;\n        };\n        Yielder.prototype.yieldBreak = function () {\n            this._current = null;\n            return false;\n        };\n        return Yielder;\n    })();\n    var EnumeratorState;\n    (function (EnumeratorState) {\n        EnumeratorState[EnumeratorState[\"Before\"] = 0] = \"Before\";\n        EnumeratorState[EnumeratorState[\"Running\"] = 1] = \"Running\";\n        EnumeratorState[EnumeratorState[\"After\"] = 2] = \"After\";\n    })(EnumeratorState || (EnumeratorState = {}));\n    var EnumeratorBase = (function (_super) {\n        __extends(EnumeratorBase, _super);\n        function EnumeratorBase(initializer, tryGetNext, disposer) {\n            _super.call(this);\n            this.initializer = initializer;\n            this.tryGetNext = tryGetNext;\n            this.disposer = disposer;\n            this.reset();\n        }\n        Object.defineProperty(EnumeratorBase.prototype, \"current\", {\n            get: function () {\n                return this._yielder.current;\n            },\n            enumerable: true,\n            configurable: true\n        });\n        EnumeratorBase.prototype.reset = function () {\n            var _ = this;\n            _._yielder = new Yielder();\n            _._state = EnumeratorState.Before;\n        };\n        EnumeratorBase.prototype.moveNext = function () {\n            var _ = this;\n            try {\n                switch (_._state) {\n                    case EnumeratorState.Before:\n                        _._state = EnumeratorState.Running;\n                        var initializer = _.initializer;\n                        if (initializer)\n                            initializer();\n                    case EnumeratorState.Running:\n                        if (_.tryGetNext(_._yielder)) {\n                            return true;\n                        }\n                        else {\n                            this.dispose();\n                            return false;\n                        }\n                    case EnumeratorState.After:\n                        return false;\n                }\n            }\n            catch (e) {\n                this.dispose();\n                throw e;\n            }\n        };\n        EnumeratorBase.prototype._onDispose = function () {\n            var _ = this, disposer = _.disposer;\n            _.initializer = null;\n            _.disposer = null;\n            var yielder = _._yielder;\n            _._yielder = null;\n            if (yielder)\n                yielder.yieldBreak();\n            try {\n                if (disposer)\n                    disposer();\n            }\n            finally {\n                this._state = EnumeratorState.After;\n            }\n        };\n        return EnumeratorBase;\n    })(DisposableBase_1.default);\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.default = EnumeratorBase;\n});\n","/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\n///<reference path=\"../../Disposable/IDisposable.d.ts\"/>\r\n///<reference path=\"IEnumerator.d.ts\"/>\r\n///<reference path=\"IYield.d.ts\"/>\r\n'use strict'; // For compatibility with (let, const, function, class);\r\n\r\nimport Type from '../../Types';\r\nimport DisposableBase from '../../Disposable/DisposableBase'\r\n\r\n\r\n\r\nclass Yielder<T> implements IYield<T>\r\n{\r\n\tprivate _current:T;\r\n\tget current():T { return this._current; }\r\n\r\n\tyieldReturn(value:T):boolean {\r\n\t\tthis._current = value;\r\n\t\treturn true;\r\n\t}\r\n\r\n\tyieldBreak():boolean {\r\n\t\tthis._current = null;\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\n// IEnumerator State\r\nenum EnumeratorState { Before, Running, After }\r\n\r\n// Naming this class EnumeratorBase to avoid collision with IE.\r\nexport default\r\nclass EnumeratorBase<T> extends DisposableBase implements IEnumerator<T>\r\n{\r\n\r\n\tprivate _yielder:Yielder<T>;\r\n\tprivate _state:EnumeratorState;\r\n\r\n\tget current():T {\r\n\t\treturn this._yielder.current;\r\n\t}\r\n\r\n\t// \"Enumerator\" is conflict JScript's \"Enumerator\"\r\n\tconstructor(\r\n\t\tprivate initializer:() => void,\r\n\t\tprivate tryGetNext:(yielder:IYield<T>) => boolean,\r\n\t\tprivate disposer?:() => void)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\r\n\treset():void {\r\n\t\tvar _ = this;\r\n\t\t_._yielder = new Yielder<T>();\r\n\t\t_._state = EnumeratorState.Before;\r\n\t}\r\n\r\n\tmoveNext():boolean {\r\n\t\tvar _ = this;\r\n\t\ttry {\r\n\t\t\tswitch(_._state) {\r\n\t\t\t\tcase EnumeratorState.Before:\r\n\t\t\t\t\t_._state = EnumeratorState.Running;\r\n\t\t\t\t\tvar initializer = _.initializer;\r\n\t\t\t\t\tif(initializer)\r\n\t\t\t\t\t\tinitializer();\r\n\t\t\t\t// fall through\r\n\t\t\t\tcase EnumeratorState.Running:\r\n\t\t\t\t\tif(_.tryGetNext(_._yielder)) {\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.dispose();\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnumeratorState.After:\r\n\t\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch(e) {\r\n\t\t\tthis.dispose();\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected _onDispose():void {\r\n\t\tvar _ = this, disposer = _.disposer;\r\n\r\n\t\t_.initializer = null;\r\n\t\t_.disposer = null;\r\n\r\n\t\tvar yielder = _._yielder;\r\n\t\t_._yielder = null;\r\n\t\tif(yielder)\r\n\t\t\tyielder.yieldBreak();\r\n\r\n\t\ttry {\r\n\r\n\t\t\tif(disposer)\r\n\t\t\t\tdisposer();\r\n\r\n\t\t}\r\n\t\tfinally {\r\n\t\t\t//if(this._state==EnumeratorState.Running)\r\n\t\t\tthis._state = EnumeratorState.After;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n"]}