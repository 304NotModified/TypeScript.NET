/*!
 * @author electricessence / https://github.com/electricessence/
 * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md
 * Based on code from: https://github.com/kriskowal/q
 */
define(["require","exports","../Types","../Collections/LinkedNodeList","../Collections/Queue"],function(e,n,t,o,i){"use strict";function s(){for(var e;e=m.first;){var n=e.task,t=e.domain;m.removeNode(e),t&&t.enter(),r(n,t)}for(var o;o=l.dequeue();)r(o);p=!1}function r(e,n){try{e()}catch(t){if(a)throw n&&n.exit(),setTimeout(s,0),n&&n.enter(),t;setTimeout(function(){throw t},0)}n&&n.exit()}function u(){p||(p=!0,d())}function c(e){var n=this,t={task:e,domain:a&&process.domain};return m.addNode(t),u(),{cancel:function(){return!!m.removeNode(t)},dispose:function(){n.cancel()}}}function f(e){l.enqueue(e),u()}var d,a=!1,p=!1,m=new o.LinkedNodeList,l=new i.Queue;if(Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=c,n.runAfterDeferred=f,t.Type.isObject(process)&&"[object process]"===process.toString()&&process.nextTick)a=!0,d=function(){process.nextTick(s)};else if("function"==typeof setImmediate)d="undefined"!=typeof window?setImmediate.bind(window,s):function(){setImmediate(s)};else if("undefined"!=typeof MessageChannel){var v=new MessageChannel;v.port1.onmessage=function(){d=w,v.port1.onmessage=s,s()};var w=function(){v.port2.postMessage(0)};d=function(){setTimeout(s,0),w()}}else d=function(){setTimeout(s,0)}});
//# sourceMappingURL=deferImmediate.js.map
