{"version":3,"sources":["System/Events/EventDispatcher.js","System/Events/EventDispatcher.ts"],"names":["__extends","this","d","b","__","constructor","p","hasOwnProperty","prototype","Object","create","deps","factory","module","exports","v","require","undefined","define","amd","shallowCopy_1","DisposableBase_1","AU","DISPOSING","DISPOSED","EventDispatcherEntry","_super","EventDispatcherEntry.constructor","EventDispatcherEntry.dispose","get","EventDispatcherEntry.wasDisposed","enumerable","configurable","EventDispatcherEntry.matches","EventDispatcherEntry.equals","defineProperty","value","EventDispatcher","EventDispatcher.constructor","EventDispatcher.addEventListener","EventDispatcher.registerEventListener","EventDispatcher.hasEventListener","EventDispatcher.removeEventListener","EventDispatcher.dispatchEvent","priority","a","EventDispatcher.DISPOSING","EventDispatcher.DISPOSED","EventDispatcher.isDisposing","EventDispatcher.dispose"],"mappings":"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","file":"System/Events/EventDispatcher.js","sourcesContent":["/*\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\n(function (deps, factory) {\r\n    if (typeof module === 'object' && typeof module.exports === 'object') {\r\n        var v = factory(require, exports); if (v !== undefined) module.exports = v;\r\n    }\r\n    else if (typeof define === 'function' && define.amd) {\r\n        define(deps, factory);\r\n    }\r\n})([\"require\", \"exports\", '../Utility/shallowCopy', '../Disposable/DisposableBase', '../Collections/Array/Utility'], function (require, exports) {\r\n    ///<reference path=\"../Disposable/IDisposable.d.ts\"/>\r\n    ///<reference path=\"IEventDispatcher.d.ts\"/>\r\n    var shallowCopy_1 = require('../Utility/shallowCopy');\r\n    var DisposableBase_1 = require('../Disposable/DisposableBase');\r\n    var AU = require('../Collections/Array/Utility');\r\n    var DISPOSING = 'disposing', DISPOSED = 'disposed';\r\n    var EventDispatcherEntry = (function (_super) {\r\n        __extends(EventDispatcherEntry, _super);\r\n        function EventDispatcherEntry(type, listener, useCapture, priority) {\r\n            if (useCapture === void 0) { useCapture = false; }\r\n            if (priority === void 0) { priority = 0; }\r\n            _super.call(this);\r\n            this.type = type;\r\n            this.listener = listener;\r\n            this.useCapture = useCapture;\r\n            this.priority = priority;\r\n            var _ = this;\r\n            _.type = type;\r\n            _.listener = listener;\r\n            _.useCapture = useCapture;\r\n            _.priority = priority;\r\n        }\r\n        EventDispatcherEntry.prototype.dispose = function () {\r\n            this.listener = null;\r\n        };\r\n        Object.defineProperty(EventDispatcherEntry.prototype, \"wasDisposed\", {\r\n            get: function () {\r\n                return this.listener == null;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        EventDispatcherEntry.prototype.matches = function (type, listener, useCapture) {\r\n            if (useCapture === void 0) { useCapture = false; }\r\n            var _ = this;\r\n            return _.type == type\r\n                && _.listener == listener\r\n                && _.useCapture == useCapture;\r\n        };\r\n        EventDispatcherEntry.prototype.equals = function (other) {\r\n            var _ = this;\r\n            return _.type == other.type\r\n                && _.listener == other.listener\r\n                && _.useCapture == other.useCapture\r\n                && _.priority == other.priority;\r\n        };\r\n        return EventDispatcherEntry;\r\n    })(DisposableBase_1.default);\r\n    Object.defineProperty(exports, \"__esModule\", { value: true });\r\n    exports.default = EventDispatcherEntry;\r\n    var EventDispatcher = (function (_super) {\r\n        __extends(EventDispatcher, _super);\r\n        function EventDispatcher() {\r\n            _super.apply(this, arguments);\r\n            this._isDisposing = false;\r\n        }\r\n        EventDispatcher.prototype.addEventListener = function (type, listener, useCapture, priority) {\r\n            if (useCapture === void 0) { useCapture = false; }\r\n            if (priority === void 0) { priority = 0; }\r\n            var l = this._listeners;\r\n            if (!l)\r\n                this._listeners = l = [];\r\n            l.push(new EventDispatcherEntry(type, listener, useCapture, priority));\r\n        };\r\n        EventDispatcher.prototype.registerEventListener = function (type, listener, useCapture, priority) {\r\n            if (useCapture === void 0) { useCapture = false; }\r\n            if (priority === void 0) { priority = 0; }\r\n            if (!this.hasEventListener(type, listener, useCapture))\r\n                this.addEventListener(type, listener, useCapture, priority);\r\n        };\r\n        EventDispatcher.prototype.hasEventListener = function (type, listener, useCapture) {\r\n            if (useCapture === void 0) { useCapture = false; }\r\n            var l = this._listeners;\r\n            return l && l.some(function (value) {\r\n                return type == value.type && (!listener || listener == value.listener && useCapture == value.useCapture);\r\n            });\r\n        };\r\n        EventDispatcher.prototype.removeEventListener = function (type, listener, userCapture) {\r\n            if (userCapture === void 0) { userCapture = false; }\r\n            var l = this._listeners;\r\n            if (l) {\r\n                var i = AU.findIndex(l, function (entry) { return entry.matches(type, listener, userCapture); });\r\n                if (i != -1) {\r\n                    var e = l[i];\r\n                    l.splice(i, 1);\r\n                    e.dispose();\r\n                }\r\n            }\r\n        };\r\n        EventDispatcher.prototype.dispatchEvent = function (e, params) {\r\n            var _this = this;\r\n            var _ = this, l = _._listeners;\r\n            if (!l || !l.length)\r\n                return false;\r\n            var event;\r\n            if (typeof e == \"string\") {\r\n                event = Object.create(Event);\r\n                if (!params)\r\n                    params = {};\r\n                event.cancelable = !!params.cancelable;\r\n                event.target = _;\r\n                event.type = e;\r\n            }\r\n            else\r\n                event = e;\r\n            var type = event.type;\r\n            var entries = [];\r\n            l.forEach(function (e) { if (e.type == type)\r\n                entries.push(e); });\r\n            if (!entries.length)\r\n                return false;\r\n            entries.sort(function (a, b) { return b.priority - a.priority; });\r\n            entries.forEach(function (entry) {\r\n                var newEvent = Object.create(Event);\r\n                shallowCopy_1.default(event, newEvent);\r\n                newEvent.target = _this;\r\n                entry.listener(newEvent);\r\n            });\r\n            return true;\r\n        };\r\n        Object.defineProperty(EventDispatcher, \"DISPOSING\", {\r\n            get: function () { return DISPOSING; },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        Object.defineProperty(EventDispatcher, \"DISPOSED\", {\r\n            get: function () { return DISPOSED; },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        Object.defineProperty(EventDispatcher.prototype, \"isDisposing\", {\r\n            get: function () {\r\n                return this._isDisposing;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n        EventDispatcher.prototype.dispose = function () {\r\n            var _ = this;\r\n            if (!_.wasDisposed && !_._isDisposing) {\r\n                _._isDisposing = true;\r\n                _.dispatchEvent(DISPOSING);\r\n                _super.prototype.dispose.call(this);\r\n                _.dispatchEvent(DISPOSED);\r\n                var l = _._listeners;\r\n                if (l) {\r\n                    this._listeners = null;\r\n                    l.forEach(function (e) { return e.dispose(); });\r\n                }\r\n            }\r\n        };\r\n        return EventDispatcher;\r\n    })(DisposableBase_1.default);\r\n});\r\n//# sourceMappingURL=EventDispatcher.js.map","/*\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\n///<reference path=\"../Disposable/IDisposable.d.ts\"/>\r\n///<reference path=\"IEventDispatcher.d.ts\"/>\r\n\r\nimport shallowCopy from '../Utility/shallowCopy';\r\nimport DisposableBase from '../Disposable/DisposableBase';\r\nimport * as AU from '../Collections/Array/Utility';\r\n\r\nconst DISPOSING:string = 'disposing',\r\n      DISPOSED:string = 'disposed';\r\n\r\nexport default\r\nclass EventDispatcherEntry extends DisposableBase\r\n{\r\n\r\n\tconstructor(\r\n\t\tpublic type:string,\r\n\t\tpublic listener:EventListener,\r\n\t\tpublic useCapture:boolean = false,\r\n\t\tpublic priority:number = 0)//, useWeakReference: boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\t\tvar _ = this;\r\n\t\t_.type = type;\r\n\t\t_.listener = listener;\r\n\t\t_.useCapture = useCapture;\r\n\t\t_.priority = priority;\r\n\t\t// _.useWeakReference = useWeakReference;\r\n\t}\r\n\r\n\t// useWeakReference: boolean;\r\n\r\n\tdispose():void {\r\n\t\tthis.listener = null;\r\n\t}\r\n\r\n\tget wasDisposed():boolean {\r\n\t\treturn this.listener==null;\r\n\t}\r\n\r\n\tmatches(type:string, listener:EventListener, useCapture:boolean = false):boolean {\r\n\t\tvar _ = this;\r\n\t\treturn _.type==type\r\n\t\t       && _.listener==listener\r\n\t\t       && _.useCapture==useCapture;\r\n\t}\r\n\r\n\tequals(other:EventDispatcherEntry):boolean {\r\n\t\tvar _ = this;\r\n\t\treturn _.type==other.type\r\n\t\t       && _.listener==other.listener\r\n\t\t       && _.useCapture==other.useCapture\r\n\t\t       && _.priority==other.priority\r\n\t\t\t// && this.useWeakReference == other.useWeakReference\r\n\t\t\t;\r\n\t}\r\n}\r\n\r\nclass EventDispatcher extends DisposableBase implements IEventDispatcher\r\n{\r\n\r\n\tprivate _listeners:EventDispatcherEntry[];\r\n\r\n\taddEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:EventListener,\r\n\t\tuseCapture:boolean = false,\r\n\t\tpriority:number = 0):void//, useWeakReference: boolean= false)\r\n\t{\r\n\t\tvar l:EventDispatcherEntry[] = this._listeners;\r\n\t\tif(!l)\r\n\t\t\tthis._listeners = l = [];\r\n\r\n\t\t// flash/vibe.js means of adding is indiscriminate and will double add listeners...\r\n\t\t// we can then avoid double adds by including a 'registerEventListener' method.\r\n\t\tl.push(new EventDispatcherEntry(type, listener, useCapture, priority));//, useWeakReference));\r\n\t}\r\n\r\n\t// Allow for simple add once mechanism.\r\n\tregisterEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:EventListener,\r\n\t\tuseCapture:boolean = false,\r\n\t\tpriority:number = 0):void//, useWeakReference: boolean= false)\r\n\t{\r\n\t\tif(!this.hasEventListener(type, listener, useCapture))\r\n\t\t\tthis.addEventListener(type, listener, useCapture, priority);\r\n\t}\r\n\r\n\thasEventListener(type:string, listener?:EventListener, useCapture:boolean = false):boolean {\r\n\t\tvar l = this._listeners;\r\n\t\treturn l && l.some(\r\n\t\t\t\t(value:EventDispatcherEntry):boolean =>\r\n               type==value.type && (!listener || listener==value.listener && useCapture==value.useCapture)\r\n\t\t\t);\r\n\r\n\t}\r\n\r\n\tremoveEventListener(type:string, listener:EventListener, userCapture:boolean = false):void {\r\n\r\n\t\tvar l = this._listeners;\r\n\r\n\t\tif(l) {\r\n\t\t\tvar i = AU.findIndex(l, entry=> entry.matches(type, listener, userCapture));\r\n\t\t\tif(i!= -1) {\r\n\t\t\t\tvar e = l[i];\r\n\t\t\t\tl.splice(i, 1);\r\n\t\t\t\te.dispose();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdispatchEvent(type:string, params?:any):boolean;\r\n\tdispatchEvent(event:Event):boolean;\r\n\tdispatchEvent(e:any, params?:any):boolean {\r\n\r\n\t\tvar _ = this, l = _._listeners;\r\n\t\tif(!l || !l.length)\r\n\t\t\treturn false;\r\n\r\n\t\tvar event:Event;\r\n\r\n\t\tif(typeof e==\"string\") {\r\n\t\t\tevent = Object.create(Event);\r\n\t\t\tif(!params)\r\n\t\t\t\tparams = {};\r\n\t\t\tevent.cancelable = !!params.cancelable;\r\n\t\t\tevent.target = _;\r\n\t\t\tevent.type = e;\r\n\t\t}\r\n\t\telse\r\n\t\t\tevent = <Event>e;\r\n\r\n\t\tvar type = event.type;\r\n\r\n\t\t// noinspection JSMismatchedCollectionQueryUpdate\r\n\t\tvar entries:EventDispatcherEntry[] = [];//, propagate = true, prevent = false;\r\n\t\tl.forEach((e:EventDispatcherEntry):void => { if(e.type==type) entries.push(e); });\r\n\t\tif(!entries.length)\r\n\t\t\treturn false;\r\n\r\n\t\tentries.sort(function (a, b) { return b.priority - a.priority; });\r\n\r\n\t\t// For now... Just use simple...\r\n\t\tentries.forEach(\r\n\t\t\t\tentry=> {\r\n\t\t\t\tvar newEvent = Object.create(Event);\r\n\t\t\t\tshallowCopy(event, newEvent);\r\n\t\t\t\tnewEvent.target = this;\r\n\t\t\t\tentry.listener(newEvent);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tstatic get DISPOSING() { return DISPOSING; }\r\n\r\n\tstatic get DISPOSED() { return DISPOSED; }\r\n\r\n\t// When dispatching events, we need a way to prevent recursion when disposing.\r\n\tprivate _isDisposing:boolean = false;\r\n\tget isDisposing():boolean {\r\n\t\treturn this._isDisposing;\r\n\t}\r\n\r\n\t// Override the public method here since EventDispatcher will end up doing things a bit differently from here on.\r\n\tpublic dispose() {\r\n\r\n\t\t// Having a disposing event can allow for child objects to automatically release themselves when their parent is disposed.\r\n\t\tvar _ = this;\r\n\t\tif(!_.wasDisposed && !_._isDisposing) {\r\n\t\t\t_._isDisposing = true;\r\n\t\t\t_.dispatchEvent(DISPOSING);\r\n\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\t_.dispatchEvent(DISPOSED);\r\n\r\n\t\t\tvar l = _._listeners;\r\n\t\t\tif(l) {\r\n\t\t\t\tthis._listeners = null;\r\n\t\t\t\tl.forEach(e=> e.dispose());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\n"]}