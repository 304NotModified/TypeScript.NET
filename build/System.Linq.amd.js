var System;(function(e){var t=function(){function e(){}return e.prototype.Identity=function(e){return e},e.prototype.True=function(){return!0},e.prototype.False=function(){return!1},e.prototype.Blank=function(){},Object.defineProperty(e,"Identity",{get:function(){return n.Identity},enumerable:!0,configurable:!0}),Object.defineProperty(e,"True",{get:function(){return n.True},enumerable:!0,configurable:!0}),Object.defineProperty(e,"False",{get:function(){return n.False},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Blank",{get:function(){return n.Blank},enumerable:!0,configurable:!0}),e}();e.Functions=t;var n=new t})(System||(System={}));var System;(function(e){var t;(function(t){function n(e){return typeof e===t.Boolean}function r(e){return typeof e===t.Number}function i(e){return typeof e===t.String}function s(e){return typeof e===t.Function}t.Boolean="boolean",t.Number="number",t.String="string",t.Object=typeof {},t.Null="object",t.Undefined=typeof undefined,t.Function=typeof e.Functions.Blank,t.isBoolean=n,t.isNumber=r,t.isString=i,t.isFunction=s})(t=e.Types||(e.Types={})),Object.freeze(e.Types)})(System||(System={}));var System;(function(e){function n(e){return typeof e===t.Number&&isNaN(e)}function r(e,t,r){return r===void 0&&(r=!0),e===t||!r&&e==t||n(e)&&n(t)}function i(e,t,n){return n===void 0&&(n=!0),r(e,t,n)?0:e>t?1:t>e?-1:NaN}function s(e,n){n===void 0&&(n=0);if(n<0)return e;switch(typeof e){case t.Undefined:case t.Null:case t.String:case t.Boolean:case t.Number:case t.Function:return e}var r;if(e instanceof Array){r=e.slice();if(n>0)for(var i=0;i<r.length;i++)i in r&&(r[i]=s(r[i],n-1))}else{r={};if(n>0)for(var o in e)r[o]=s(e[o],n-1)}return r}function o(e,t){for(var n in e)t[n]=e[n]}function u(e,t){t.forEach(function(t){Object.getOwnPropertyNames(t.prototype).forEach(function(n){e.prototype[n]=t.prototype[n]})})}var t=e.Types;e.isEqualToNaN=n,e.areEqual=r,e.compare=i,e.clone=s,e.copyTo=o,e.applyMixins=u})(System||(System={}));var System;(function(e){function t(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];i(e,!1)}function n(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];i(e,!0)}function r(t,n){if(t&&typeof t.dispose==e.Types.Function)if(n)try{t.dispose()}catch(r){}else t.dispose()}function i(e,t){var n;while(e.length&&!(n=e.shift()));if(n)try{r(n,t)}finally{i(e,t)}}function s(e,t){e&&e.length&&i(e.slice(),t)}function o(e,n){try{return n(e)}finally{t(e)}}e.dispose=t,e.disposeWithoutException=n,e.disposeThese=s,e.using=o;var u=function(){function e(e){this._finalizer=e,this._wasDisposed=!1}return Object.defineProperty(e.prototype,"wasDisposed",{get:function(){return this._wasDisposed},enumerable:!0,configurable:!0}),e.assertIsNotDisposed=function(e,t){t===void 0&&(t="ObjectDisposedException");if(e)throw new Error(t);return!0},e.prototype.assertIsNotDisposed=function(t){return t===void 0&&(t="ObjectDisposedException"),e.assertIsNotDisposed(this._wasDisposed,t)},e.prototype.dispose=function(){var e=this;if(!e._wasDisposed){e._wasDisposed=!0;try{e._onDispose()}finally{e._finalizer&&e._finalizer()}}},e.prototype._onDispose=function(){},e}();e.DisposableBase=u})(System||(System={}));var System;(function(e){var t;(function(t){var n;(function(t){function n(e){var t;return e>65536?t=new Array(e):(t=new Array,t.length=e),t}function r(e,t,n){t===void 0&&(t=0),n===void 0&&(n=Infinity);if(!e)return e;var r=e.length;return t||n<r?e.slice(t,Math.min(n,r)-r):e.slice()}function i(e,t,n,r,i){n===void 0&&(n=0),r===void 0&&(r=0),i===void 0&&(i=Infinity);if(!e)throw new Error("ArgumentNullException: source array cannot be null.");if(!t)throw new Error("ArgumentNullException: destination array cannot be null.");if(n<0)throw new Error("ArgumentOutOfRangeException: source index cannot be less than zero.");var s=e.length;if(n>=s)throw new Error("ArgumentOutOfRangeException: the source index must be less than the length of the source array.");if(t.length<0)throw new Error("ArgumentOutOfRangeException: destination index cannot be less than zero.");var o=e.length-n;if(isFinite(i)&&i>o)throw new Error("ArgumentOutOfRangeException: source index + length cannot exceed the length of the source array.");i=Math.min(i,o);for(var u=0;u<i;++u)t[r+u]=e[n+u]}function s(e,t){return e?e.indexOf(t)!=-1:!1}function o(e,t,n,r){var i=0;if(r!==0){r||(r=Infinity);for(var s=e.length-1|0;s>=0;--s)if(e[s]===t){e[s]=n,++i;if(!--r)break}}return i}function u(e,t,n,r){var i=n+r;for(var s=n;s<i;++s)e[s]=t}function a(e,t,n){u(e,null,t,n)}function f(e,t){if(!e)throw new Error("ArgumentNullException: 'array' cannot be null.");var n=e.length,r=!n||!s(e,t);return r&&(e[n]=t),r}function l(t,n){if(!t)throw new Error("ArgumentNullException: 'array' cannot be null.");if(!e.Types.isFunction(n))throw new Error("InvalidArgumentException: 'predicate' must be a function.");var r=t.length|0;for(var i=0;i<r;++i)if(i in t&&n(t[i]))return i;return-1}function c(e,t){if(!e)throw new Error("ArgumentNullException: 'arrays' cannot be null.");if(e.length<2)throw new Error("Cannot compare a set of arrays less than 2.");var n=e[0];for(var r=0,i=e.length|0;r<i;++r)if(!h(n,e[r],t))return!1;return!0}function h(t,n,r,i){i===void 0&&(i=e.areEqual);if(t===n)return!0;var s=t.length|0;if(s!=(n.length|0))return!1;for(var o=0;o<s;++o)if(!i(t[o],n[o],r))return!1;return!0}function p(e,t){if(!e)throw new Error("ArgumentNullException: 'target' cannot be null.");if(t)for(var n=0;n<e.length;++n)e[n]=t(e[n]);return e}function d(e,t){if(!e)throw new Error("ArgumentNullException: 'array' cannot be null.");var n=t<e.length;return n&&e.splice(t,1),n}function v(e,t,n){if(!e)throw new Error("ArgumentNullException: 'array' cannot be null.");var r=0;if(e&&e.length&&n!==0){n||(n=Infinity);for(var i=e.length-1|0;i>=0;--i)if(e[i]===t){e.splice(i,1),++r;if(!--n)break}}return r}function m(e,t){var n=[];while(t--)n.push(e);return n}function g(e,t){t===void 0&&(t=!1);if(!e||!e.length)return 0;var n=0;return t?e.forEach(function(e){isNaN(e)||(n+=e)}):e.every(function(e){return n+=e,!isNaN(n)}),n}function y(e,t){t===void 0&&(t=!1);if(!e||!e.length)return NaN;var n=0,r;return t?(r=0,e.forEach(function(e){isNaN(e)||(n+=e,r++)})):(r=e.length,e.every(function(e){return n+=e,!isNaN(n)})),!r||isNaN(n)?NaN:n/r}function b(e,t){t===void 0&&(t=!1);if(!e||!e.length)return NaN;var n=1;if(t){var r=!1;e.forEach(function(e){isNaN(e)||(n*=e,r||(r=!0))}),r||(n=NaN)}else e.every(function(e){return isNaN(e)?(n=NaN,!1):(n*=e,!0)});return n}function w(e,t,n,r){if(!e||!e.length)return NaN;var i=t;if(n){var s=!1;e.forEach(function(e){isNaN(e)||(r(e,i)&&(i=e),s||(s=!0))}),s||(i=NaN)}else e.every(function(e){return isNaN(e)?(i=NaN,!1):(r(e,i)&&(i=e),!0)});return i}function E(e,t){return t===void 0&&(t=!1),w(e,+Infinity,t,function(e,t){return e<t})}function S(e,t){return t===void 0&&(t=!1),w(e,-Infinity,t,function(e,t){return e>t})}t.initialize=n,t.copy=r,t.copyTo=i,t.contains=s,t.replace=o,t.updateRange=u,t.clear=a,t.register=f,t.findIndex=l,t.areAllEqual=c,t.areEqual=h,t.applyTo=p,t.removeIndex=d,t.remove=v,t.repeat=m,t.sum=g,t.average=y,t.product=b,t.min=E,t.max=S})(n=t.ArrayUtility||(t.ArrayUtility={}))})(t=e.Collections||(e.Collections={}))})(System||(System={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},System;(function(e){var t=e.Collections.ArrayUtility,n=function(e){function t(t,n,r,i){r===void 0&&(r=!1),i===void 0&&(i=0),e.call(this),this.type=t,this.listener=n,this.useCapture=r,this.priority=i}return __extends(t,e),t.prototype.dispose=function(){this.listener=null},Object.defineProperty(t.prototype,"wasDisposed",{get:function(){return this.listener==null},enumerable:!0,configurable:!0}),t.prototype.matches=function(e,t,n){n===void 0&&(n=!1);var r=this;return r.type==e&&r.listener==t&&r.useCapture==n},t.prototype.equals=function(e){var t=this;return t.type==e.type&&t.listener==e.listener&&t.useCapture==e.useCapture&&t.priority==e.priority},t}(e.DisposableBase),r=function(r){function i(){r.apply(this,arguments),this._isDisposing=!1}return __extends(i,r),i.prototype.addEventListener=function(e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);var s=this._listeners;s||(this._listeners=s=[]),s.push(new n(e,t,r,i))},i.prototype.registerEventListener=function(e,t,n,r){n===void 0&&(n=!1),r===void 0&&(r=0),this.hasEventListener(e,t,n)||this.addEventListener(e,t,n,r)},i.prototype.hasEventListener=function(e,t,n){n===void 0&&(n=!1);var r=this._listeners;return r&&r.some(function(r){return e==r.type&&(!t||t==r.listener&&n==r.useCapture)})},i.prototype.removeEventListener=function(e,n,r){r===void 0&&(r=!1);var i=this._listeners;if(i){var s=t.findIndex(i,function(t){return t.matches(e,n,r)});if(s!=-1){var o=i[s];i.splice(s,1),o.dispose()}}},i.prototype.dispatchEvent=function(t,n){var r=this,i=this,s=i._listeners;if(!s||!s.length)return!1;var o;typeof t=="string"?(o=new Event,n||(n={}),o.cancelable=!!n.cancelable,o.target=i,o.type=t):o=t;var u=o.type,a=[];return s.forEach(function(e){e.type==u&&a.push(e)}),a.length?(a.sort(function(e,t){return t.priority-e.priority}),a.forEach(function(t){var n=new Event;e.copyTo(o,n),n.target=r,t.listener(n)}),!0):!1},Object.defineProperty(i,"DISPOSING",{get:function(){return"disposing"},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DISPOSED",{get:function(){return"disposed"},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isDisposing",{get:function(){return this._isDisposing},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){var e=this;if(!e.wasDisposed&&!e._isDisposing){e._isDisposing=!0,e.dispatchEvent(i.DISPOSING),r.prototype.dispose.call(this),e.dispatchEvent(i.DISPOSED);var t=e._listeners;t&&(this._listeners=null,t.forEach(function(e){return e.dispose()}))}},i}(e.DisposableBase);e.EventDispatcher=r})(System||(System={}));var DisposableBase=System.DisposableBase,System;(function(e){var t=function(e){function t(t){e.call(this),this._closure=t}return __extends(t,e),Object.defineProperty(t.prototype,"isValueCreated",{get:function(){return this._isValueCreated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canReset",{get:function(){return!this.wasDisposed&&!!this._closure},enumerable:!0,configurable:!0}),t.prototype.reset=function(e){var t=this;e&&t.assertIsNotDisposed();if(!t._closure){if(e)throw new Error("Cannot reset.  This Lazy has already de-referenced its closure.");return!1}return t._isValueCreated=!1,t._value=null,!0},Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype.getValue=function(e){var t=this;t.assertIsNotDisposed();try{if(!t._isValueCreated&&t._closure){var n=t._closure();return t._value=n,t._isValueCreated=!0,n}}finally{e&&(t._closure=null)}return t._value},t.prototype._onDispose=function(){this._closure=null,this._value=null},t.prototype.equals=function(e){return this==e},t.prototype.valueEquals=function(e){return this.equals(e)||this.value===e.value},t}(e.DisposableBase);e.Lazy=t})(System||(System={}));var System;(function(e){function o(e,t){return Math.abs(e)!==1&&(t+="s"),t}function a(e){if(isNaN(e)||e>5||e<0||Math.floor(e)!==e)throw new Error("Invalid TimeUnit.");return!0}function l(e){if(!(e instanceof h||e instanceof d))throw new Error("Invalid comparison type.  Must be of type TimeUnitValue or TimeSpan.")}function c(e){if(e instanceof h){var t=e;return t.type===1?t.value:t.toTimeSpan().milliseconds}return e instanceof d?e._milliseconds:undefined}var t=1e4,n=1e3,r=60,i=60,s=24;(function(e){e[e.Ticks=0]="Ticks",e[e.Milliseconds=1]="Milliseconds",e[e.Seconds=2]="Seconds",e[e.Minutes=3]="Minutes",e[e.Hours=4]="Hours",e[e.Days=5]="Days"})(e.TimeUnit||(e.TimeUnit={}));var u=e.TimeUnit;Object.freeze(u);var f=function(){function u(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._totalMilliseconds=e.length>1?d.millisecondsFromTime(e[0]||0,e[1]||0,e.length>2&&e[2]||0,e.length>3&&e[3]||0):e.length>0&&e[0]||0}return Object.defineProperty(u.prototype,"totalMilliseconds",{get:function(){return this._totalMilliseconds},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"direction",{get:function(){return e.compare(this._totalMilliseconds,0)},enumerable:!0,configurable:!0}),u.prototype.equals=function(t){return e.areEqual(this._totalMilliseconds,t.totalMilliseconds)},u.prototype.compareTo=function(t){return t==null?1:e.compare(this._totalMilliseconds,t.totalMilliseconds)},Object.defineProperty(u.prototype,"ticks",{get:function(){var e=this,n=e._ticks;if(n===undefined){var r=Math.abs(e._totalMilliseconds);e._ticks=n=(r-Math.floor(r))*t}return n},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"milliseconds",{get:function(){var e=this,t=e._ms;return t===undefined&&(e._ms=t=this._totalMilliseconds%n|0),t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"seconds",{get:function(){var e=this,t=e._seconds;return t===undefined&&(e._seconds=t=this._totalMilliseconds/n%r|0),t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"minutes",{get:function(){var e=this,t=e._minutes;return t===undefined&&(e._minutes=t=this._totalMilliseconds/n/r%i|0),t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"hours",{get:function(){var e=this,t=e._hours;return t===undefined&&(e._hours=t=this._totalMilliseconds/n/r/i%s|0),t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"days",{get:function(){var e=this,t=e._days;return t===undefined&&(e._days=t=this._totalMilliseconds/n/r/i/s|0),t},enumerable:!0,configurable:!0}),u.prototype.toTimeSpan=function(){return new d(this._totalMilliseconds)},u.from=function(e,t,n,r){return n===void 0&&(n=0),r===void 0&&(r=0),new u(e,t,n,r)},u.prototype.toString=function(e,t){var n=this,r=[];return n.days&&r.push(o(n.days,"day")),n.hours&&r.push(o(n.hours,"hour")),n.minutes&&r.push(o(n.minutes,"minute")),n.seconds&&r.push(o(n.seconds,"second")),r.length>1&&r.splice(r.length-1,0,"and"),r.join(", ").replace(", and, "," and ")},u}();e.ClockTime=f;var h=function(){function t(e,t){this.value=e,this._type=t,a(t)}return t.prototype.coerce=function(e){var n=this._type;a(n);if(e instanceof d)e=e.toTimeUnitValue(n);else{if(!(e instanceof t))return null;n!==e.type&&(e=e.to(n))}return e},t.prototype.equals=function(t){var n=this.coerce(t);return n==null?!1:e.areEqual(this.value,n.value)},t.prototype.compareTo=function(t){return t==null?1:(l(t),e.compare(this.value,this.coerce(t).value))},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.toTimeSpan=function(){return new d(this.value,this.type)},t.prototype.to=function(e){return e===void 0&&(e=this.type),this.toTimeSpan().toTimeUnitValue(e)},t}();e.TimeUnitValue=h;var p,d=function(){function o(e,t){t===void 0&&(t=1),this._milliseconds=o.convertToMilliseconds(e,t)}return o.prototype.equals=function(t){var n=c(t);return t===undefined?!1:e.areEqual(this._milliseconds,n)},o.prototype.compareTo=function(t){return t==null?1:(l(t),e.compare(this._milliseconds,c(t)))},o.prototype.toTimeUnitValue=function(e){return e===void 0&&(e=1),new h(this.total(e),e)},o.convertToMilliseconds=function(e,o){o===void 0&&(o=1);switch(o){case 5:e*=s;case 4:e*=i;case 3:e*=r;case 2:e*=n;case 1:return e;case 0:return e/t;default:throw new Error("Invalid TimeUnit.")}},o.prototype.total=function(e){var n=this;switch(e){case 5:return n.days;case 4:return n.hours;case 3:return n.minutes;case 2:return n.seconds;case 1:return n._milliseconds;case 0:return n._milliseconds*t;default:throw new Error("Invalid TimeUnit.")}},Object.defineProperty(o.prototype,"ticks",{get:function(){return this._milliseconds*t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"milliseconds",{get:function(){return this._milliseconds},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"seconds",{get:function(){return this._milliseconds/n},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"minutes",{get:function(){return this.seconds/r},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"hours",{get:function(){return this.minutes/i},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"days",{get:function(){return this.hours/s},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"time",{get:function(){return new f(this._milliseconds)},enumerable:!0,configurable:!0}),o.prototype.add=function(t){if(e.Types.isNumber(t))throw new Error("Use .addUnit to add a numerical value amount.  .add only supports ClockTime, TimeSpan, and TimeUnitValue.");if(t instanceof h||t instanceof f)t=t.toTimeSpan();return new o(this._milliseconds+t.milliseconds)},o.prototype.addUnit=function(e,t){return t===void 0&&(t=1),new o(this._milliseconds+o.convertToMilliseconds(e,t))},o.from=function(e,t){return new o(e,t)},o.fromDays=function(e){return new o(e,5)},o.fromHours=function(e){return new o(e,4)},o.fromMinutes=function(e){return new o(e,3)},o.fromSeconds=function(e){return new o(e,2)},o.fromMilliseconds=function(e){return new o(e,1)},o.fromTicks=function(e){return new o(e,0)},o.fromTime=function(e,t,n,r){return n===void 0&&(n=0),r===void 0&&(r=0),new o(o.millisecondsFromTime(e,t,n,r))},o.millisecondsFromTime=function(e,t,s,o){s===void 0&&(s=0),o===void 0&&(o=0);var u=e;return u*=i,u+=t,u*=r,u+=s,u*=n,u+=o,u},o.between=function(e,t){return new o(t.getTime()-e.getTime())},Object.defineProperty(o,"zero",{get:function(){return p||(p=new o(0))},enumerable:!0,configurable:!0}),o}();e.TimeSpan=d})(System||(System={}));var System;(function(e){var t;(function(t){function n(e,t){throw t===void 0&&(t=""),console.log("DictionaryAbstractBase sub-class has not overridden "+e+". "+t),new Error("DictionaryAbstractBase."+e+": Not implemented.")}var r=function(){function r(){this._updateRecursion=0}return Object.defineProperty(r.prototype,"isUpdating",{get:function(){return this._updateRecursion!=0},enumerable:!0,configurable:!0}),r.prototype._onValueUpdate=function(t,n,r){if(!e.areEqual(n,r,!0)){var i=this;i.onValueChanged&&i.onValueChanged(t,n,r),i._updateRecursion==0&&i._onUpdated()}},r.prototype._onUpdated=function(){var e=this;e.onUpdated&&e.onUpdated()},r.prototype.handleUpdate=function(e){var t=this,n;if(e){t._updateRecursion++;try{n=e()}finally{t._updateRecursion--}}else n=t._updateRecursion==0;return n&&t._updateRecursion==0&&t._onUpdated(),n},Object.defineProperty(r.prototype,"isReadOnly",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return n("count")},enumerable:!0,configurable:!0}),r.prototype.add=function(e){this.addByKeyValue(e.key,e.value)},r.prototype.clear=function(){var e=this,t=e.keys,n=t.length;return n&&e.handleUpdate(function(){return t.forEach(function(t){e.removeByKey(t)}),!0}),e.count!=0&&console.warn("Dictioary clear() results in mismatched count."),n},r.prototype.contains=function(t){var n=this.get(t.key);return e.areEqual(n,t.value)},r.prototype.copyTo=function(e,t){t===void 0&&(t=0);var n=this.getEnumerator();while(n.moveNext())e[t++]=n.current},r.prototype.remove=function(t){var n=t.key,r=this.get(n);return e.areEqual(r,t.value)&&this.removeByKey(n)?1:0},Object.defineProperty(r.prototype,"keys",{get:function(){return n("keys")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"values",{get:function(){return n("values")},enumerable:!0,configurable:!0}),r.prototype.addByKeyValue=function(e,t){var n=this;if(n.containsKey(e))throw new Error("Adding key/value when one already exists.");n.set(e,t)},r.prototype.get=function(e){return n("get(key: TKey): TValue","When calling for key: "+e)},r.prototype.set=function(e,t){return n("set(key: TKey, value: TValue): boolean","When setting "+e+":"+t+".")},r.prototype.containsKey=function(e){var t=this.get(e);return t!==undefined},r.prototype.containsValue=function(t){var n=this.getEnumerator(),r=e.areEqual;while(n.moveNext())if(r(n.current,t,!0))return n.dispose(),!0;return!1},r.prototype.removeByKey=function(e){return this.set(e,undefined)},r.prototype.removeByValue=function(t){var n=this,r=0,i=e.areEqual;return n.keys.forEach(function(e){i(n.get(e),t,!0)&&(n.removeByKey(e),++r)}),r},r.prototype.importPairs=function(e){var t=this;return t.handleUpdate(function(){var n=!1;return e.forEach(function(e){t.set(e.key,e.value),n=!0}),n})},r.prototype.getEnumerator=function(){var e=this,n,r,i=0;return new t.EnumeratorBase(function(){n=e.keys,r=n.length},function(t){while(i<r){var s=n[i++],o=e.get(s);if(o!==undefined)return t.yieldReturn({key:s,value:o})}return t.yieldBreak()})},r}();t.DictionaryAbstractBase=r})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(t){return t===null?"null":t===undefined?"undefined":typeof t.toString===e.Types.Function?t.toString():Object.prototype.toString.call(t)}var n=function(){function e(e,t,n,r){this.key=e,this.value=t,this.prev=n,this.next=r}return e}(),r=function(){function e(e,t){this.first=e,this.last=t}return e.prototype.addLast=function(e){var t=this;t.last!=null?(t.last.next=e,e.prev=t.last,t.last=e):t.first=t.last=e},e.prototype.replace=function(e,t){var n=this;e.prev!=null?(e.prev.next=t,t.prev=e.prev):n.first=t,e.next!=null?(e.next.prev=t,t.next=e.next):n.last=t},e.prototype.remove=function(e){var t=this;e.prev!=null?e.prev.next=e.next:t.first=e.next,e.next!=null?e.next.prev=e.prev:t.last=e.prev},e.prototype.clear=function(){var e=this;while(e.last)e.remove(e.last)},e.prototype.forEach=function(e){var t=this,n=t.first;while(n)e(n),n=n.next},e}(),o=function(o){function u(t){t===void 0&&(t=e.Functions.Identity),o.call(this),this.compareSelector=t,this._count=0,this._entries=new r,this._buckets={}}return __extends(u,o),u.prototype.setKV=function(t,r,o){var u=this,a=u._buckets,f=u._entries,l=u.compareSelector,c=l(t),h=s(c),p;if(i(a,h)){var d=e.areEqual,v=a[h];for(var m=0;m<v.length;m++){var g=v[m];if(l(g.key)===c){if(!o)throw new Error("Key already exists.");var y=!d(g.value,r);return y&&(r===undefined?(f.remove(g),v.splice(m,1),v.length||delete a[h],--u._count):(p=new n(t,r),f.replace(g,p),v[m]=p),u._onValueUpdate(t,r,g.value)),y}}v.push(p=p||new n(t,r))}else{if(r===undefined){if(o)return!1;throw new Error("Cannot add 'undefined' value.")}a[h]=[p=new n(t,r)]}return++u._count,f.addLast(p),u._onValueUpdate(t,r,undefined),!0},u.prototype.addByKeyValue=function(e,t){this.setKV(e,t,!1)},u.prototype.get=function(e){var t=this._buckets,n=this.compareSelector,r=n(e),o=s(r);if(!i(t,o))return undefined;var u=t[o];for(var a=0,f=u.length;a<f;a++){var l=u[a];if(n(l.key)===r)return l.value}return undefined},u.prototype.set=function(e,t){return this.setKV(e,t,!0)},u.prototype.containsKey=function(e){var t=this,n=t._buckets,r=t.compareSelector,o=r(e),u=s(o);if(!i(n,u))return!1;var a=n[u];for(var f=0,l=a.length;f<l;f++)if(r(a[f].key)===o)return!0;return!1},u.prototype.clear=function(){var e=this,t=e._buckets,n=o.prototype.clear.call(this);e._count=0;for(var r in t)t.hasOwnProperty(r)&&delete t[r];return e._entries.clear(),n},Object.defineProperty(u.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),u.prototype.getEnumerator=function(){var e=this,n;return new t.EnumeratorBase(function(){n=e._entries.first},function(e){if(n!=null){var t={key:n.key,value:n.value};return n=n.next,e.yieldReturn(t)}return e.yieldBreak()})},Object.defineProperty(u.prototype,"keys",{get:function(){var e=this,t=[];return e._entries.forEach(function(e){return t.push(e.key)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"values",{get:function(){var e=this,t=[];return e._entries.forEach(function(e){return t.push(e.value)}),t},enumerable:!0,configurable:!0}),u}(t.DictionaryAbstractBase);t.Dictionary=o})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){var n=function(){function e(){}return Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),e.prototype.yieldReturn=function(e){return this._current=e,!0},e.prototype.yieldBreak=function(){return this._current=null,!1},e}(),r;(function(e){e[e.Before=0]="Before",e[e.Running=1]="Running",e[e.After=2]="After"})(r||(r={}));var i;(function(t){function n(t){if(t instanceof Array)return new u(t);if(typeof t===e.Types.Object&&"length"in t)return new o(function(){return{source:t,length:t.length,pointer:0,step:1}});if("getEnumerator"in t)return t.getEnumerator();throw new Error("Unknown enumerable.")}function r(e,t){if(e){var n=0;while(e.moveNext())if(t(e.current,n++)===!1)break}}t.from=n,t.forEach=r})(i=t.Enumerator||(t.Enumerator={}));var s=function(e){function t(t,n,r){e.call(this),this.initializer=t,this.tryGetNext=n,this.disposer=r,this.reset()}return __extends(t,e),Object.defineProperty(t.prototype,"current",{get:function(){return this._yielder.current},enumerable:!0,configurable:!0}),t.prototype.reset=function(){var e=this;e._yielder=new n,e._state=0},t.prototype.moveNext=function(){var e=this;try{switch(e._state){case 0:e._state=1;var t=e.initializer;t&&t();case 1:return e.tryGetNext(e._yielder)?!0:(this.dispose(),!1);case 2:return!1}}catch(n){throw this.dispose(),n}},t.prototype._onDispose=function(){var e=this,t=e.disposer;e.initializer=null,e.disposer=null;var n=e._yielder;e._yielder=null,n&&n.yieldBreak();try{t&&t()}finally{this._state=2}},t}(e.DisposableBase);t.EnumeratorBase=s;var o=function(e){function t(t){var n;e.call(this,function(){n=t();if(n&&n.source){if(n.length&&n.step===0)throw new Error("Invalid IndexEnumerator step value (0).");var e=n.pointer;if(!e)n.pointer=0;else if(e!=Math.floor(e))throw new Error("Invalid IndexEnumerator pointer value ("+e+") has decimal.");n.pointer=e|0;var r=n.step;if(!r)n.step=1;else if(r!=Math.floor(r))throw new Error("Invalid IndexEnumerator step value ("+r+") has decimal.");n.step=r|0}},function(e){var t=n&&n.source?n.length:0;if(!t)return e.yieldBreak();var r=n.pointer|0;return n.pointer+=n.step,r<t&&r>=0?e.yieldReturn(n.source[r]):e.yieldBreak()},function(){n&&(n.source=null)})}return __extends(t,e),t}(s);t.IndexEnumerator=o;var u=function(t){function n(n,r,i){r===void 0&&(r=0),i===void 0&&(i=1),t.call(this,function(){var t=e.Types.isFunction(n)?n():n;return{source:t,pointer:r,length:t?t.length:0,step:i}})}return __extends(n,t),n}(o);t.ArrayEnumerator=u})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){var n;(function(n){function r(n,r){n&&e.using(n.getEnumerator(),function(e){t.Enumerator.forEach(e,r)})}n.forEach=r})(n=t.Enumerable||(t.Enumerable={}))})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(e){function t(e){var t=[];for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)e=e.replace("{"+r+"}",t[r]);return e}e.format=t})(t=e.Text||(e.Text={}))})(System||(System={}));var System;(function(e){var t;(function(t){function s(e,t){if(!e)return null;var n=e.external;return n||(e.external=n=new a(t,e)),n}function o(e,t){if(!e)throw new Error("ArgumentNullException: 'node' cannot be null.");if(e.list!=t)throw new Error("InvalidOperationException: provided node does not belong to this list.");var n=e._node;if(!n)throw new Error("InvalidOperationException: provided node is not valid.");return n}var n=0,r=1,i=function(){function e(e,t,n){this.value=e,this.prev=t,this.next=n}return e.prototype.assertDetached=function(){if(this.next||this.prev)throw new Error("InvalidOperationException: adding a node that is already placed.")},e}(),u=function(){function u(e){var r=this,s=n,o=null,u=null,a=t.Enumerator.from(e);a.moveNext()&&(o=u=new i(a.current),++s);while(a.moveNext())u=u.next=new i(a.current,u),++s;r._first=o,r._last=u,r._count=s}return u.prototype._addFirst=function(e){var t=this,n=t._first,s=new i(e,null,n);return n?(n.prev=s,n=s):t._first=t._last=s,t._count+=r,s},u.prototype._addLast=function(e){var t=this,n=t._last,s=new i(e,n);return n?(n.next=s,n=s):t._first=t._last=s,t._count+=r,s},u.prototype._addNodeBefore=function(e,t){t.assertDetached(),t.next=e,t.prev=e.prev,e.prev.next=t,e.prev=t,this._count+=r},u.prototype._addNodeAfter=function(e,t){t.assertDetached(),t.prev=e,t.next=e.next,e.next.prev=t,e.next=t,this._count+=r},u.prototype._findFirst=function(t){var n=e.areEqual,r=this._first;while(r){if(n(t,r.value))return r;r=r.next}return null},u.prototype._findLast=function(t){var n=e.areEqual,r=this._last;while(r){if(n(t,r.value))return r;r=r.prev}return null},u.prototype.forEach=function(e){var t=this._first,r=n;while(t&&e(t.value,r++)!==!1)t=t.next},u.prototype.getEnumerator=function(){var e=this,n;return new t.EnumeratorBase(function(){n=new i(null,null,e._first)},function(e){return(n=n.next)?e.yieldReturn(n.value):e.yieldBreak()})},Object.defineProperty(u.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"isReadOnly",{get:function(){return!1},enumerable:!0,configurable:!0}),u.prototype.add=function(e){this._addLast(e)},u.prototype.clear=function(){var e=this;e._first=null,e._last=null;var t=e._count;return e._count=0,t},u.prototype.contains=function(t){var n=!1,r=e.areEqual;return this.forEach(function(e){return!(n=r(t,e))}),n},u.prototype.copyTo=function(e,t){t===void 0&&(t=0),this.forEach(function(n,r){e[t+r]=n})},u.prototype.removeOnce=function(e){var t=this,n=t._findFirst(e);if(n){var i=n.prev,s=n.next;i?i.next=s:t._first=s,s?s.prev=i:t._last=i,t._count-=r}return n!=null},u.prototype.remove=function(e){var t=this,r=n;while(t.removeOnce(e))++r;return r},u.prototype.toArray=function(){var e=t.ArrayUtility.initialize(this._count);return this.copyTo(e),e},Object.defineProperty(u.prototype,"first",{get:function(){return s(this._first,this)},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"last",{get:function(){return s(this._last,this)},enumerable:!0,configurable:!0}),u.prototype._get=function(e){if(e<0)throw new Error("ArgumentOutOfRangeException: index is less than zero.");if(e>=this._count)throw new Error("ArgumentOutOfRangeException: index is greater than count.");var t=this._first,r=n;while(t&&e<r++)t=t.next;return t},u.prototype.get=function(e){return this._get(e).value},u.prototype.getNode=function(e){return s(this._get(e),this)},u.prototype.find=function(e){return s(this._findFirst(e),this)},u.prototype.findLast=function(e){return s(this._findLast(e),this)},u.prototype.addFirst=function(e){this._addFirst(e)},u.prototype.addLast=function(e){this._addLast(e)},u.prototype.removeFirst=function(){var e=this,t=e._first;if(t){var n=t.next;e._first=n,n&&(n.prev=null),e._count-=r}},u.prototype.removeLast=function(){var e=this,t=e._last;if(t){var n=t.prev;e._last=n,n&&(n.next=null),e._count-=r}},u.prototype.removeNode=function(t){var n=this,r=o(t,n),i=r.prev,s=r.next,u=!1,a=!1;i?i.next=s:n._first==r?n._first=s:u=!0,s?s.prev=i:n._last==r?n._last=i:a=!0;if(u!==a)throw new Error(e.Text.format("Exception: provided node is has no {0} reference but is not the {1} node!",u?"previous":"next",u?"first":"last"));return!u&&!a},u.prototype.addBefore=function(e,t){this._addNodeBefore(o(e,this),new i(t))},u.prototype.addAfter=function(e,t){this._addNodeAfter(o(e,this),new i(t))},u.prototype.addNodeBefore=function(e,t){this._addNodeBefore(o(e,this),o(t,this))},u.prototype.addNodeAfter=function(e,t){this._addNodeAfter(o(e,this),o(t,this))},u}();t.LinkedList=u;var a=function(){function e(e,t){this._list=e,this._node=t}return Object.defineProperty(e.prototype,"list",{get:function(){return this._list},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return s(this._node.prev,this._list)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return s(this._node.next,this._list)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._node.value},set:function(e){this._node.value=e},enumerable:!0,configurable:!0}),e.prototype.addBefore=function(e){this._list.addBefore(this,e)},e.prototype.addAfter=function(e){this._list.addAfter(this,e)},e.prototype.addNodeBefore=function(e){this._list.addNodeBefore(this,e)},e.prototype.addNodeAfter=function(e){this._list.addNodeAfter(this,e)},e}()})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){var n=function(t){function n(){t.apply(this,arguments),this._count=0,this._map={}}return __extends(n,t),n.prototype.containsKey=function(e){return e in this._map},n.prototype.containsValue=function(t){var n=this._map,r=e.areEqual;for(var i in n)if(n.hasOwnProperty(i)&&r(n[i],t))return!0;return!1},n.prototype.get=function(e){return this._map[e]},n.prototype.set=function(e,t){var n=this,r=n._map,i=r[e];return i!==t?(t===undefined?e in r&&(delete r[e],--n._count):(e in r||++n._count,r[e]=t),n._onValueUpdate(e,t,i),!0):!1},n.prototype.importMap=function(e){var t=this;return t.handleUpdate(function(){var n=!1;for(var r in e)e.hasOwnProperty(r)&&t.set(r,e[r])&&(n=!0);return n})},n.prototype.toMap=function(e){var t=this,n={};for(var r in t._map)if(t._map.hasOwnProperty(r)){var i=t._map[r];e&&(i=e(r,i)),i!==undefined&&(n[r]=i)}return n},Object.defineProperty(n.prototype,"keys",{get:function(){var e=this,t=[];for(var n in e._map)e._map.hasOwnProperty(n)&&t.push(n);return t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"values",{get:function(){var e=this,t=[];for(var n in e._map)e._map.hasOwnProperty(n)&&t.push(e._map[n]);return t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),n}(t.DictionaryAbstractBase);t.StringKeyDictionary=n})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(e){var t=function(t){function n(){t.call(this),this._order=[]}return __extends(n,t),n.prototype.indexOfKey=function(e){return this._order.indexOf(e,0)},n.prototype.getValueByIndex=function(e){return this.get(this._order[e])},n.prototype.set=function(n,r,i){var s=this,o=s.indexOfKey(n)!=-1;return!o&&(r!==undefined||i)?s._order.push(n):o&&r===undefined&&!i&&e.ArrayUtility.remove(s._order,n),t.prototype.set.call(this,n,r)},n.prototype.setByIndex=function(e,t){var n=this,r=n._order;if(e<0||e>=r.length)throw new Error("IndexOutOfRange Exception.");return n.set(r[e],t)},n.prototype.importValues=function(e){var t=this;return t.handleUpdate(function(){var n=!1;for(var r=0;r<e.length;r++)t.setByIndex(r,e[r])&&(n=!0);return n})},n.prototype.setValues=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.importValues(e)},n.prototype.removeByIndex=function(e){return this.setByIndex(e,undefined)},Object.defineProperty(n.prototype,"keys",{get:function(){var e=this;return e._order.filter(function(t){return e.containsKey(t)})},enumerable:!0,configurable:!0}),n}(e.StringKeyDictionary);e.OrderedStringKeyDictionary=t})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){function o(e,t){if(e!=Math.floor(e))throw new Error("InvalidOperationException: "+t+" must be an interger.")}function u(e,t){if(e<0)throw new Error("ArgumentOutOfRangeException: "+t+" must be greater than zero")}function a(e,t){o(e,t),u(e,t)}var n=4,r=100,i=n,s=[],f=function(){function o(n){var r=this;r._head=0,r._tail=0,r._size=0,r._version=0,n?e.Types.isNumber(n)?(a(n,"source"),r._array=n?t.ArrayUtility.initialize(n):s):(r._array=t.ArrayUtility.initialize(n instanceof Array||"length"in n?n.length:i),t.Enumerable.forEach(n,function(e){return r.enqueue(e)}),r._version=0):r._array=s,r._capacity=r._array.length}return Object.defineProperty(o.prototype,"count",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isReadOnly",{get:function(){return!1},enumerable:!0,configurable:!0}),o.prototype.add=function(e){this.enqueue(e)},o.prototype.clear=function(){var e=this,n=e._array,r=e._head,i=e._tail,s=e._size;return r<i?t.ArrayUtility.clear(n,r,s):(t.ArrayUtility.clear(n,r,n.length-r),t.ArrayUtility.clear(n,0,i)),e._head=0,e._tail=0,e._size=0,e._version++,s},o.prototype.contains=function(t){var n=this,r=n._array,i=n._head,s=n._size,o=n._capacity;while(s-->0){if(e.areEqual(r[i],t))return!0;i=(i+1)%o}return!1},o.prototype.copyTo=function(e,n){n===void 0&&(n=0);if(e==null)throw new Error("ArgumentNullException: array cannot be null.");a(n,"arrayIndex");var r=e.length,i=this,s=i._size,o=r-n<s?r-n:s;if(o==0)return;var u=i._array,f=i._capacity,l=i._head,c=f-l,h=c<o?c:o;t.ArrayUtility.copyTo(u,e,l,n,h),o-=h,o>0&&t.ArrayUtility.copyTo(u,e,0,n+f-l,o)},o.prototype.remove=function(e){throw new Error("ICollection<T>.remove is not implemented in Queue<T> since it would require destroying the underlying array to remove the item.")},o.prototype.dispose=function(){var e=this;e.clear(),e._array!=s&&(e._array.length=e._capacity=0,e._array=s),e._version=0},o.prototype.toArray=function(){var e=this,n=e._size,r=t.ArrayUtility.initialize(n);return n==0?r:(e.copyTo(r),r)},o.prototype.setCapacity=function(e){a(e,"capacity");var n=this,r=n._array,i=n._capacity;if(e==i)return;var o=n._head,u=n._tail,f=n._size;if(r!=s&&e>i&&o<u){r.length=n._capacity=e,n._version++;return}var l=t.ArrayUtility.initialize(e);f>0&&(o<u?t.ArrayUtility.copyTo(r,l,o,0,f):(t.ArrayUtility.copyTo(r,l,o,0,i-o),t.ArrayUtility.copyTo(r,l,0,i-o,u))),n._array=l,n._capacity=e,n._head=0,n._tail=f==e?0:f,n._version++},o.prototype.enqueue=function(e){var t=this,i=t._array,s=t._size|0,o=t._capacity|0;if(s==o){var u=o*r;u<o+n&&(u=o+n),t.setCapacity(u),i=t._array,o=t._capacity}var a=t._tail;i[a]=e,t._tail=(a+1)%o,t._size=s+1,t._version++},o.prototype.dequeue=function(){var e=this;if(e._size==0)throw new Error("InvalidOperatioException: cannot dequeue an empty queue.");var t=e._array,n=e._head,r=e._array[n];return t[n]=null,e._head=(n+1)%e._capacity,e._size--,e._version++,r},o.prototype._getElement=function(e){a(e,"index");var t=this;return t._array[(t._head+e)%t._capacity]},o.prototype.peek=function(){if(this._size==0)throw new Error("InvalidOperatioException: cannot call peek on an empty queue.");return this._array[this._head]},o.prototype.trimExcess=function(){var e=this,t=e._size;t<Math.floor(e._capacity*.9)&&e.setCapacity(t)},o.prototype.getEnumerator=function(){var e=this,n,r;return new t.EnumeratorBase(function(){r=e._version,n=0},function(t){if(r!=e._version)throw new Error("InvalidOperationException: collection was changed during enumeration.");return n==e._size?t.yieldBreak():t.yieldReturn(e._getElement(n++))})},o}();t.Queue=f})(t=e.Collections||(e.Collections={}))})(System||(System={}));var System;(function(e){var t;(function(t){var n=function(){function t(){this.reset()}return t.getTimestampMilliseconds=function(){return(new Date).getTime()},Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!0,configurable:!0}),t.startNew=function(){var e=new t;return e.start(),e},t.measure=function(n){var r=t.getTimestampMilliseconds();return n(),new e.TimeSpan(t.getTimestampMilliseconds()-r)},t.prototype.record=function(e){var n=t.measure(e);return this._elapsed+=n.milliseconds,n},t.prototype.start=function(){var e=this;e._isRunning||(e._startTimeStamp=t.getTimestampMilliseconds(),e._isRunning=!0)},t.prototype.stop=function(){var e=this;e._isRunning&&(e._elapsed+=e.currentLapMilliseconds,e._isRunning=!1)},t.prototype.reset=function(){var e=this;e._elapsed=0,e._isRunning=!1,e._startTimeStamp=NaN},t.prototype.lap=function(){var n=this;if(n._isRunning){var r=t.getTimestampMilliseconds(),i=n._startTimeStamp,s=r-i;return n._startTimeStamp=r,n._elapsed+=s,new e.TimeSpan(s)}return e.TimeSpan.zero},Object.defineProperty(t.prototype,"currentLapMilliseconds",{get:function(){return this._isRunning?t.getTimestampMilliseconds()-this._startTimeStamp:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLap",{get:function(){return this._isRunning?new e.TimeSpan(this.currentLapMilliseconds):e.TimeSpan.zero},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elapsedMilliseconds",{get:function(){var e=this,t=e._elapsed;return e._isRunning&&(t+=e.currentLapMilliseconds),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elapsed",{get:function(){return new e.TimeSpan(this.elapsedMilliseconds)},enumerable:!0,configurable:!0}),t}();t.Stopwatch=n})(t=e.Diagnostics||(e.Diagnostics={}))})(System||(System={}));var LinkedList=System.Collections.LinkedList,System;(function(e){var t;(function(t){var n=e.Types,r=function(){function e(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=this;n._latest=null,n._partArray=[],n.appendThese(e)}return e.prototype.appendSingle=function(e){if(e!==null&&e!==undefined){var t=this;t._latest=null;switch(typeof e){case n.Object:case n.Function:e=e.toString()}t._partArray.push(e)}},e.prototype.appendThese=function(e){var t=this;return e.forEach(function(e){return t.appendSingle(e)}),t},e.prototype.append=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.appendThese(e),this},e.prototype.appendLine=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.appendLines(e),this},e.prototype.appendLines=function(e){var t=this;return e.forEach(function(e){e!==null&&e!==undefined&&(t.appendSingle(e),t._partArray.push("\r\n"))}),t},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._partArray.length===0},enumerable:!0,configurable:!0}),e.prototype.toString=function(){var e=this._latest;return!e===null&&(this._latest=e=this._partArray.join()),e},e.prototype.join=function(e){return this._partArray.join(e)},e.prototype.clear=function(){this._partArray.length=0,this._latest=null},e.prototype.dispose=function(){this.clear()},e}();t.StringBuilder=r})(t=e.Text||(e.Text={}))})(System||(System={})),define("System",function(){});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},System;(function(e){var t;(function(t){function v(t){return e.DisposableBase.assertIsNotDisposed(t,"Enumerable was disposed.")}function m(e){return isNaN(e)?NaN:e}function g(e,t){if(typeof e===f.Number&&!isNaN(e)&&e!=(e|0))throw new Error("'"+t+"'"+" must be an integer.");return!0}var n=e.Collections.ArrayUtility,r=e.Collections.EnumeratorBase,i=e.Collections.Dictionary,s=e.Collections.Queue,o=e.using,u=e.Collections.Enumerator.from,a=e.Collections.Enumerator.forEach,f=e.Types,l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.Greater=function(e,t){return e>t?e:t},t.prototype.Lesser=function(e,t){return e<t?e:t},t}(e.Functions),c=new l,h=0,p=-1,d=1;(function(e){e[e.Break=0]="Break",e[e.Return=1]="Return",e[e.Skip=2]="Skip"})(t.EnumerableAction||(t.EnumerableAction={}));var y=t.EnumerableAction;Object.freeze(y);var b=function(t){function l(e,n){t.call(this,n),this.enumeratorFactory=e}return __extends(l,t),l.fromArray=function(e){return new w(e)},l.from=function(t){if("getEnumerator"in t)return t;if(t instanceof Array||typeof t===e.Types.Object&&"length"in t)return l.fromArray(t);throw new Error("Unsupported enumerable.")},l.toArray=function(t){if(t instanceof Array)return t.slice();typeof t===e.Types.Object&&"length"in t&&(t=l.fromArray(t));if(t instanceof l)return t.toArray();if("getEnumerator"in t){var n=[];return a(t.getEnumerator(),function(e,t){n[t]=e}),n}throw new Error("Unsupported enumerable.")},l.prototype.getEnumerator=function(){return this.assertIsNotDisposed(),this.enumeratorFactory()},l.prototype._onDispose=function(){t.prototype._onDispose.call(this),this.enumeratorFactory=null},l.choice=function(e){return new l(function(){return new r(null,function(t){return t.yieldReturn(e[Math.random()*e.length|0])})})},l.cycle=function(e){return new l(function(){var t=h;return new r(function(){t=h},function(n){return t>=e.length&&(t=h),n.yieldReturn(e[t++])})})},l.empty=function(){return new l(function(){return new r(null,c.False)})},l.repeat=function(e,t){return t===void 0&&(t=Infinity),isNaN(t)||t<=0?l.empty():isFinite(t)&&g(t,"count")?new l(function(){var n=t|0,i=h;return new r(function(){i=h},function(t){return i++<n&&t.yieldReturn(e)})}):new l(function(){return new r(null,function(t){return t.yieldReturn(e)})})},l.repeatWithFinalize=function(e,t){return new l(function(){var n;return new r(function(){n=e()},function(e){return e.yieldReturn(n)},function(){t(n)})})},l.make=function(e){return l.repeat(e,d)},l.range=function(e,t,n){e===void 0&&(e=0),t===void 0&&(t=Infinity),n===void 0&&(n=1);if(!isFinite(e))throw new Error("Must have a valid 'start' value.");if(isNaN(t)||t<=0)return l.empty();if(!isFinite(n))throw new Error("Must have a valid 'step' value.");return isFinite(t)&&g(t,"count")?new l(function(){var i,s=t|0,o=h;return new r(function(){o=h,i=e},function(e){var r=o++<s&&e.yieldReturn(i);return r&&o<t&&(i+=n),r})}):new l(function(){var t;return new r(function(){t=e},function(e){var r=t;return t+=n,e.yieldReturn(r)})})},l.rangeDown=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=Infinity),n===void 0&&(n=1),n=Math.abs(n)*-1,l.range(e,t,n)},l.toInfinity=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=1),l.range(e,Infinity,t)},l.toNegativeInfinity=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=1),l.rangeDown(e,Infinity,t)},l.rangeTo=function(e,t,n){e===void 0&&(e=0),t===void 0&&(t=Infinity),n===void 0&&(n=1);if(!isFinite(e))throw new Error("Must have a valid 'start' value.");if(isNaN(t))throw new Error("Must have a valid 'to' value.");if(!isFinite(n))throw new Error("Must have a valid 'step' value.");return n=Math.abs(n),isFinite(t)?new l(function(){var i;return e<t?new r(function(){i=e},function(e){var r=i<=t&&e.yieldReturn(i);return r&&(i+=n),r}):new r(function(){i=e},function(e){var r=i>=t&&e.yieldReturn(i);return r&&(i-=n),r})}):l.range(e,Infinity,e<t?+n:-n)},l.matches=function(e,t,n){n===void 0&&(n="");var i=typeof e;if(i!=f.String)throw new Error("Cannot exec RegExp matches of type '"+i+"'.");return t instanceof RegExp&&(n+=t.ignoreCase?"i":"",n+=t.multiline?"m":"",t=t.source),n.indexOf("g")===-1&&(n+="g"),new l(function(){var i;return new r(function(){i=new RegExp(t,n)},function(t){var n=i.exec(e);return n!==null?t.yieldReturn(n):!1})})},l.generate=function(e,t){return t===void 0&&(t=Infinity),isNaN(t)||t<=0?l.empty():isFinite(t)&&g(t,"count")?new l(function(){var n=t|0,i=h;return new r(function(){i=h},function(t){var r=i++;return r<n&&t.yieldReturn(e(r))})}):new l(function(){var t=h;return new r(function(){t=h},function(n){return n.yieldReturn(e(t++))})})},l.unfold=function(e,t,n){return n===void 0&&(n=!1),new l(function(){var i=h,s,o;return new r(function(){i=h,s=e,o=!n},function(e){var n=i++;return o?o=!1:s=t(s,n),e.yieldReturn(s)})})},l.defer=function(t){return new l(function(){var n;return new r(function(){n=t().getEnumerator()},function(e){return n.moveNext()&&e.yieldReturn(n.current)},function(){e.dispose(n)})})},l.forEach=function(t,n){e.Collections.Enumerable.forEach(t,n)},l.max=function(e){return e.takeUntil(function(e){return e==+Infinity},!0).aggregate(c.Greater)},l.min=function(e){return e.takeUntil(function(e){return e==-Infinity},!0).aggregate(c.Lesser)},l.prototype.assertIsNotDisposed=function(e){return e===void 0&&(e="Enumerable was disposed."),t.prototype.assertIsNotDisposed.call(this,e)},l.prototype.forEach=function(e){var t=this;t.assertIsNotDisposed();var n=h;o(t.getEnumerator(),function(r){while(t.assertIsNotDisposed()&&r.moveNext())if(e(r.current,n++)===!1)break})},l.prototype.toArray=function(e){var t=[];return e?this.where(e).toArray():(this.forEach(function(e,n){t[n]=e}),t)},l.prototype.asEnumerable=function(){var e=this;return new l(function(){return e.getEnumerator()})},l.prototype.toLookup=function(e,t,n){t===void 0&&(t=c.Identity),n===void 0&&(n=c.Identity);var r=new i(n);return this.forEach(function(n){var i=e(n),s=t(n),o=r.get(i);o!==undefined?o.push(s):r.addByKeyValue(i,[s])}),new N(r)},l.prototype.toMap=function(e,t){var n={};return this.forEach(function(r){n[e(r)]=t(r)}),n},l.prototype.toDictionary=function(e,t,n){n===void 0&&(n=c.Identity);var r=new i(n);return this.forEach(function(n){return r.addByKeyValue(e(n),t(n))}),r},l.prototype.toJoinedString=function(e,t){return e===void 0&&(e=""),t===void 0&&(t=c.Identity),this.select(t).toArray().join(e)},l.prototype.doAction=function(t){var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s,o=h;return new r(function(){v(i),o=h,s=n.getEnumerator()},function(e){v(i);while(s.moveNext()){var n=t(s.current,o++);if(n===!1||n===y)return e.yieldBreak();if(n!==2)return e.yieldReturn(s.current)}return!1},function(){e.dispose(s)})},function(){i=!0})},l.prototype.force=function(e){e===void 0&&(e=0),this.assertIsNotDisposed(),this.doAction(function(t){return e})},l.prototype.skip=function(e){var t=this;t.assertIsNotDisposed();if(!e||isNaN(e)||e<0)return t;if(!isFinite(e))return l.empty();g(e,"count");var n=e|0;return this.doAction(function(e,t){return t<n?2:1})},l.prototype.skipWhile=function(e){this.assertIsNotDisposed();var t=!0;return this.doAction(function(n,r){return t&&(t=e(n,r)),t?2:1})},l.prototype.take=function(e){if(!e||isNaN(e)||e<0)return l.empty();var t=this;t.assertIsNotDisposed();if(!isFinite(e))return t;g(e,"count");var n=e|0;return t.doAction(function(e,t){return t<n})},l.prototype.takeWhile=function(e){return this.assertIsNotDisposed(),this.doAction(function(t,n){return e(t,n)?1:0})},l.prototype.takeUntil=function(e,t){this.assertIsNotDisposed();if(!t)return this.doAction(function(t,n){return e(t,n)?0:1});var n=!1;return this.doAction(function(t,r){return n?0:(n=e(t,r),1)})},l.prototype.takeExceptLast=function(t){t===void 0&&(t=1);var n=this;if(!t||isNaN(t)||t<=0)return n;if(!isFinite(t))return l.empty();g(t,"count");var i=t|0;return new l(function(){var t,o;return new r(function(){t=n.getEnumerator(),o=new s},function(e){while(t.moveNext()){o.enqueue(t.current);if(o.count>i)return e.yieldReturn(o.dequeue())}return!1},function(){e.dispose(t,o)})})},l.prototype.takeFromLast=function(e){if(!e||isNaN(e)||e<=0)return l.empty();var t=this;return isFinite(e)?(g(e,"count"),t.reverse().take(e|0)):t.reverse()},l.prototype.traverseBreadthFirst=function(t,n){var i=this;return new l(function(){var s,o=h,u,a;return new r(function(){o=h,u=[],a=0,s=i.getEnumerator()},function(e){for(;;){if(s.moveNext())return u[a++]=s.current,e.yieldReturn(n(s.current,o));if(!a)return e.yieldBreak();var r=l.fromArray(u).selectMany(t);if(!r.any())return e.yieldBreak();o++,u=[],a=0,s.dispose(),s=r.getEnumerator()}},function(){e.dispose(s),u.length=0})})},l.prototype.traverseDepthFirst=function(t,n){var i=this;return new l(function(){var s=[],o,u;return new r(function(){o=i.getEnumerator(),u=0},function(e){for(;;){if(o.moveNext()){var r=n(o.current,u);return s[u++]=o,o=t(o.current).getEnumerator(),e.yieldReturn(r)}if(u==0)return!1;o.dispose(),o=s[--u],s.length=u}},function(){try{e.dispose(o)}finally{e.disposeThese(s)}})})},l.prototype.flatten=function(){var t=this;return new l(function(){var n,i=null;return new r(function(){n=t.getEnumerator()},function(e){for(;;){if(i!=null){if(i.moveNext())return e.yieldReturn(i.current);i=null}if(n.moveNext()){var t=n.current;if(t instanceof Array){i.dispose(),i=l.fromArray(t).selectMany(c.Identity).flatten().getEnumerator();continue}return e.yieldReturn(n.current)}return!1}},function(){e.dispose(n,i)})})},l.prototype.pairwise=function(t){var n=this;return new l(function(){var i;return new r(function(){i=n.getEnumerator(),i.moveNext()},function(e){var n=i.current;return i.moveNext()&&e.yieldReturn(t(n,i.current))},function(){e.dispose(i)})})},l.prototype.scan=function(t,n){var i=n!==undefined,s=this;return new l(function(){var o,u,a;return new r(function(){o=s.getEnumerator(),a=!0},function(e){return a?(a=!1,i?e.yieldReturn(u=n):o.moveNext()&&e.yieldReturn(u=o.current)):o.moveNext()?e.yieldReturn(u=t(u,o.current)):!1},function(){e.dispose(o)})})},l.prototype.select=function(t){var n=this,i=!n.assertIsNotDisposed();return t.length<2?new S(n,null,t):new l(function(){var s,o=h;return new r(function(){v(i),o=h,s=n.getEnumerator()},function(e){return v(i),s.moveNext()?e.yieldReturn(t(s.current,o++)):!1},function(){e.dispose(s)})},function(){i=!0})},l.prototype.selectMany=function(t,n){var i=this;return n||(n=function(e,t){return t}),new l(function(){var s,o,u=h;return new r(function(){s=i.getEnumerator(),o=undefined,u=h},function(r){if(o===undefined&&!s.moveNext())return!1;do{if(!o){var i=t(s.current,u++);if(!i)continue;o=e.Collections.Enumerator.from(i)}if(o.moveNext())return r.yieldReturn(n(s.current,o.current));o.dispose(),o=null}while(s.moveNext());return!1},function(){e.dispose(s,o),s=null,o=null})})},l.prototype.choose=function(t){var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s,o=h;return new r(function(){v(i),o=h,s=n.getEnumerator()},function(e){v(i);while(s.moveNext()){var n=t(s.current,o++);if(n!==null&&n!==undefined)return e.yieldReturn(n)}return!1},function(){e.dispose(s)})},function(){i=!0})},l.prototype.where=function(t){var n=this,i=!n.assertIsNotDisposed();return t.length<2?new E(n,t):new l(function(){var s,o=h;return new r(function(){v(i),o=h,s=n.getEnumerator()},function(e){v(i);while(s.moveNext())if(t(s.current,o++))return e.yieldReturn(s.current);return!1},function(){e.dispose(s)})},function(){i=!0})},l.prototype.ofType=function(e){var t;switch(e){case Number:t=f.Number;break;case String:t=f.String;break;case Boolean:t=f.Boolean;break;case Function:t=f.Function;break;default:t=null}return t===null?this.where(function(t){return t instanceof e}):this.where(function(e){return typeof e===t})},l.prototype.except=function(t,n){var i=this,s=!i.assertIsNotDisposed();return new l(function(){var o,u;return new r(function(){v(s),o=i.getEnumerator(),u=new e.Collections.Dictionary(n),t&&l.forEach(t,function(e){return u.addByKeyValue(e,!0)})},function(e){v(s);while(o.moveNext()){var t=o.current;if(!u.containsKey(t))return u.addByKeyValue(t,!0),e.yieldReturn(t)}return!1},function(){e.dispose(o),u.clear()})},function(){s=!0})},l.prototype.distinct=function(e){return this.except(null,e)},l.prototype.distinctUntilChanged=function(t){var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s,o,u=!0;return new r(function(){v(i),s=n.getEnumerator()},function(e){v(i);while(s.moveNext()){var n=t(s.current);if(u)u=!1;else if(o===n)continue;return o=n,e.yieldReturn(s.current)}return!1},function(){e.dispose(s)})},function(){i=!0})},l.prototype.reverse=function(){var e=this,t=!e.assertIsNotDisposed();return new l(function(){var n,i=h;return new r(function(){v(t),n=e.toArray(),i=n.length|0},function(e){return i>h&&e.yieldReturn(n[--i])},function(){n.length=0})},function(){t=!0})},l.prototype.shuffle=function(){var e=this,t=!e.assertIsNotDisposed();return new l(function(){var n,i,s;return new r(function(){v(t),n=e.toArray(),i=s=n.length},function(e){if(!s)return e.yieldBreak();var t=Math.random()*s|0,r=n[t],i=n[--s];return n[t]=i,n[s]=null,s%32==0&&(n.length=s),e.yieldReturn(r)},function(){n.length=0})},function(){t=!0})},l.prototype.count=function(e){var t=this;t.assertIsNotDisposed();var n=h;return e?t.forEach(function(t,r){e(t,r)&&++n}):t.forEach(function(){++n}),n},l.prototype.all=function(e){var t=!0;return this.forEach(function(n){if(!e(n))return t=!1,!1}),t},l.prototype.every=function(e){return this.all(e)},l.prototype.any=function(e){var t=!1;return e?this.forEach(function(n){return t=e(n),!t}):this.forEach(function(){return t=!0,!1}),t},l.prototype.some=function(e){return this.any(e)},l.prototype.isEmpty=function(){return!this.any()},l.prototype.contains=function(e,t){return t?this.any(function(n){return t(n)===t(e)}):this.any(function(t){return t===e})},l.prototype.indexOf=function(t,n){var r=p;return n?this.forEach(function(i,s){if(e.areEqual(n(i),n(t),!0))return r=s,!1}):this.forEach(function(n,i){if(e.areEqual(n,t,!0))return r=i,!1}),r},l.prototype.lastIndexOf=function(t,n){var r=p;return n?this.forEach(function(i,s){e.areEqual(n(i),n(t),!0)&&(r=s)}):this.forEach(function(n,i){e.areEqual(n,t,!0)&&(r=i)}),r},l.prototype.defaultIfEmpty=function(t){t===void 0&&(t=null);var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s,o;return new r(function(){o=!0,v(i),s=n.getEnumerator()},function(e){return v(i),s.moveNext()?(o=!1,e.yieldReturn(s.current)):o?(o=!1,e.yieldReturn(t)):!1},function(){e.dispose(s)})})},l.prototype.zip=function(t,n){var i=this;return new l(function(){var s,o,a=h;return new r(function(){a=h,s=i.getEnumerator(),o=u(t)},function(e){return s.moveNext()&&o.moveNext()&&e.yieldReturn(n(s.current,o.current,a++))},function(){e.dispose(s,o)})})},l.prototype.zipMultiple=function(t,n){var i=this;return t.length?new l(function(){var o,a,f,l=h;return new r(function(){o=new s(t),l=h,a=i.getEnumerator(),f=null},function(e){if(a.moveNext())for(;;){while(!f){var t;if(!o.count)return e.yieldBreak();var t=o.dequeue();t&&(f=u(t))}if(f.moveNext())return e.yieldReturn(n(a.current,f.current,l++));f.dispose(),f=null}return e.yieldBreak()},function(){e.dispose(a,o)})}):l.empty()},l.prototype.join=function(t,n,i,s,o){o===void 0&&(o=c.Identity);var u=this;return new l(function(){var a,f,p=null,d=h;return new r(function(){a=u.getEnumerator(),f=l.from(t).toLookup(i,c.Identity,o)},function(e){for(;;){if(p!=null){var t=p[d++];if(t!==undefined)return e.yieldReturn(s(a.current,t));t=null,d=h}if(!a.moveNext())return e.yieldBreak();var r=n(a.current);p=f.get(r)}},function(){e.dispose(a)})})},l.prototype.groupJoin=function(t,n,i,s,o){o===void 0&&(o=c.Identity);var u=this;return new l(function(){var a,f=null;return new r(function(){a=u.getEnumerator(),f=l.from(t).toLookup(i,c.Identity,o)},function(e){return a.moveNext()&&e.yieldReturn(s(a.current,f.get(n(a.current))))},function(){e.dispose(a)})})},l.prototype.concatWith=function(t){var n=this;return new l(function(){var i,s;return new r(function(){i=n.getEnumerator()},function(e){if(i!=null){if(i.moveNext())return e.yieldReturn(i.current);s=u(t),i.dispose(),i=null}return s.moveNext()?e.yieldReturn(s.current):!1},function(){e.dispose(i,s)})})},l.prototype.merge=function(t){var n=this;return t.length?t.length==1?n.concatWith(t[0]):new l(function(){var i,o;return new r(function(){i=n.getEnumerator(),o=new s(t)},function(e){for(;;){while(!i&&o.count)i=u(o.dequeue());if(i&&i.moveNext())return e.yieldReturn(i.current);if(i){i.dispose(),i=null;continue}return e.yieldBreak()}},function(){e.dispose(i,o)})}):n},l.prototype.concat=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=this;return e.length==0?n:e.length==1?n.concatWith(e[0]):n.merge(e)},l.prototype.insertAt=function(t,n){if(isNaN(t)||t<0||!isFinite(t))throw new Error("'index' is invalid or out of bounds.");g(t,"index");var i=t|0,s=this;return s.assertIsNotDisposed(),new l(function(){var t,o,a=h,f=!1;return new r(function(){a=h,t=s.getEnumerator(),o=u(n),f=!1},function(e){if(a==i){f=!0;if(o.moveNext())return e.yieldReturn(o.current)}return t.moveNext()?(a++,e.yieldReturn(t.current)):!f&&o.moveNext()&&e.yieldReturn(o.current)},function(){e.dispose(t,o)})})},l.prototype.alternateMultiple=function(t){var n=this;return new l(function(){var i,s,o,u;return new r(function(){u=new e.Collections.ArrayEnumerator(l.toArray(t)),o=n.getEnumerator();var r=o.moveNext();s=r?1:0,r&&(i=o.current)},function(e){switch(s){case 0:return e.yieldBreak();case 2:if(u.moveNext())return e.yieldReturn(u.current);u.reset(),s=1}var t=i,n=o.moveNext();return s=n?2:0,n&&(i=o.current),e.yieldReturn(t)},function(){e.dispose(o,u)})})},l.prototype.alternateSingle=function(e){return this.alternateMultiple(l.make(e))},l.prototype.alternate=function(){var e=[];for(var t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.alternateMultiple(e)},l.prototype.intersect=function(t,n){var s=this;return new l(function(){var o,u,a;return new r(function(){o=s.getEnumerator(),u=new i(n),a=new i(n),l.from(t).forEach(function(e){u.addByKeyValue(e,!0)})},function(e){while(o.moveNext()){var t=o.current;if(!a.containsKey(t)&&u.containsKey(t))return a.addByKeyValue(t,!0),e.yieldReturn(t)}return e.yieldBreak()},function(){e.dispose(o)})})},l.prototype.sequenceEqual=function(t,n){return n===void 0&&(n=e.areEqual),o(this.getEnumerator(),function(e){return o(l.from(t).getEnumerator(),function(t){while(e.moveNext())if(!t.moveNext()||!n(e.current,t.current))return!1;return!t.moveNext()})})},l.prototype.union=function(t,n){n===void 0&&(n=c.Identity);var s=this;return new l(function(){var o,u,a;return new r(function(){o=s.getEnumerator(),a=new i(n)},function(e){var n;if(u===undefined){while(o.moveNext()){n=o.current;if(!a.containsKey(n))return a.addByKeyValue(n,null),e.yieldReturn(n)}u=l.from(t).getEnumerator()}while(u.moveNext()){n=u.current;if(!a.containsKey(n))return a.addByKeyValue(n,null),e.yieldReturn(n)}return!1},function(){e.dispose(o,u)})})},l.prototype.orderBy=function(e){return e===void 0&&(e=c.Identity),new x(this,e,!1)},l.prototype.orderByDescending=function(e){return e===void 0&&(e=c.Identity),new x(this,e,!0)},l.prototype.groupBy=function(e,t,n){t===void 0&&(t=c.Identity);var r=this;return new l(function(){return r.toLookup(e,t,n).getEnumerator()})},l.prototype.partitionBy=function(t,n,i,s){n===void 0&&(n=c.Identity),i===void 0&&(i=function(e,t){return new C(e,t)}),s===void 0&&(s=c.Identity);var o=this;return new l(function(){var u,a,f,l,c;return new r(function(){u=o.getEnumerator(),u.moveNext()?(a=t(u.current),f=s(a),l=[n(u.current)],c=1):l=null},function(e){if(!l)return e.yieldBreak();var r,o;while(r=u.moveNext()){o=u.current;if(f!==s(t(o)))break;l[c++]=n(o)}var h=i(a,l);return r?(o=u.current,a=t(o),f=s(a),l=[n(o)],c=1):l=null,e.yieldReturn(h)},function(){e.dispose(u),l=null})})},l.prototype.buffer=function(t){if(t<1||!isFinite(t))throw new Error("Invalid buffer size.");g(t,"size");var i=this,s;return new l(function(){var o;return new r(function(){o=i.getEnumerator()},function(e){var r=n.initialize(t);s=0;while(s<t&&o.moveNext)r[s++]=o.current;return r.length=s,s&&e.yieldReturn(r)},function(){e.dispose(o)})})},l.prototype.aggregate=function(e,t){return this.scan(e,t).lastOrDefault()},l.prototype.average=function(e){e===void 0&&(e=m);var t=0,n=0,r=0;return this.forEach(function(i){var s=e(i);if(isNaN(s))return t=NaN,!1;isFinite(s)?t+=s:n+=s>0?1:-1,++r}),n?n*Infinity:isNaN(t)||!r?NaN:t/r},l.prototype.max=function(){return this.aggregate(c.Greater)},l.prototype.min=function(){return this.aggregate(c.Lesser)},l.prototype.maxBy=function(e){return e===void 0&&(e=c.Identity),this.aggregate(function(t,n){return e(t)>e(n)?t:n})},l.prototype.minBy=function(e){return e===void 0&&(e=c.Identity),this.aggregate(function(t,n){return e(t)<e(n)?t:n})},l.prototype.sum=function(e){e===void 0&&(e=m);var t=0,n=0;return this.forEach(function(r){var i=e(r);if(isNaN(i))return t=NaN,!1;isFinite(i)?t+=i:n+=i>0?1:-1}),isNaN(t)?NaN:n?n*Infinity:t},l.prototype.product=function(e){e===void 0&&(e=m);var t=1,n=!1;return this.forEach(function(r){n=!0;var i=e(r);if(isNaN(i))return t=NaN,!1;if(i==0)return t=0,!1;t*=i}),n&&isNaN(t)?NaN:t},l.prototype.elementAt=function(e){if(isNaN(e)||e<0||!isFinite(e))throw new Error("'index' is invalid or out of bounds.");g(e,"index");var t=e|0,n=this;n.assertIsNotDisposed();var r,i=!1;n.forEach(function(e,n){if(n==t)return r=e,i=!0,!1});if(!i)throw new Error("index is less than 0 or greater than or equal to the number of elements in source.");return r},l.prototype.elementAtOrDefault=function(e,t){t===void 0&&(t=null);if(isNaN(e)||e<0||!isFinite(e))throw new Error("'index' is invalid or out of bounds.");g(e,"index");var n=e|0,r=this;r.assertIsNotDisposed();var i,s=!1;return r.forEach(function(e,t){if(t==n)return i=e,s=!0,!1}),s?i:t},l.prototype.first=function(){var e=this;e.assertIsNotDisposed();var t,n=!1;e.forEach(function(e){return t=e,n=!0,!1});if(!n)throw new Error("first:No element satisfies the condition.");return t},l.prototype.firstOrDefault=function(e){e===void 0&&(e=null);var t=this;t.assertIsNotDisposed();var n,r=!1;return t.forEach(function(e){return n=e,r=!0,!1}),r?n:e},l.prototype.last=function(){var e=this;e.assertIsNotDisposed();var t,n=!1;e.forEach(function(e){n=!0,t=e});if(!n)throw new Error("last:No element satisfies the condition.");return t},l.prototype.lastOrDefault=function(e){e===void 0&&(e=null);var t=this;t.assertIsNotDisposed();var n,r=!1;return t.forEach(function(e){r=!0,n=e}),r?n:e},l.prototype.single=function(){var e=this;e.assertIsNotDisposed();var t,n=!1;e.forEach(function(e){if(!!n)throw new Error("single:sequence contains more than one element.");n=!0,t=e});if(!n)throw new Error("single:No element satisfies the condition.");return t},l.prototype.singleOrDefault=function(e){e===void 0&&(e=null);var t=this;t.assertIsNotDisposed();var n,r=!1;return t.forEach(function(e){if(!!r)throw new Error("single:sequence contains more than one element.");r=!0,n=e}),r?n:e},l.prototype.share=function(){var t=this;t.assertIsNotDisposed();var n;return new l(function(){return new r(function(){n||(n=t.getEnumerator())},function(e){return n.moveNext()&&e.yieldReturn(n.current)})},function(){e.dispose(n)})},l.prototype.memoize=function(){var t=this,n=!t.assertIsNotDisposed(),i,s;return new l(function(){var e=h;return new r(function(){v(n),s||(s=t.getEnumerator()),i||(i=[]),e=h},function(t){v(n);var r=e++;return r>=i.length?s.moveNext()?t.yieldReturn(i[r]=s.current):!1:t.yieldReturn(i[r])})},function(){n=!0,i&&(i.length=0),i=null,e.dispose(s),s=null})},l.prototype.catchError=function(t){var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s;return new r(function(){try{v(i),s=n.getEnumerator()}catch(e){}},function(e){try{v(i);if(s.moveNext())return e.yieldReturn(s.current)}catch(n){t(n)}return!1},function(){e.dispose(s)})})},l.prototype.finallyAction=function(t){var n=this,i=!n.assertIsNotDisposed();return new l(function(){var s;return new r(function(){v(i),s=n.getEnumerator()},function(e){return v(i),s.moveNext()?e.yieldReturn(s.current):!1},function(){try{e.dispose(s)}finally{t()}})})},l}(e.DisposableBase);t.Enumerable=b;var w=function(t){function r(n){var r=this;r._source=n,t.call(this,function(){return r.assertIsNotDisposed(),new e.Collections.ArrayEnumerator(function(){return r.assertIsNotDisposed("The underlying ArrayEnumerable was disposed."),r._source})})}return __extends(r,t),r.prototype._onDispose=function(){t.prototype._onDispose.call(this),this._source=null},Object.defineProperty(r.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),r.prototype.toArray=function(){var e=this.source;if(!e)return[];if(e instanceof Array)return e.slice();var t=e.length,n=new Array(t);for(var r=h;r<t;++r)n[r]=e[r];return n},r.prototype.asEnumerable=function(){return new r(this._source)},r.prototype.forEach=function(e){var t=this;t.assertIsNotDisposed();var n=t._source;if(n)for(var r=h;r<n.length;++r)if(e(n[r],r)===!1)break},r.prototype.any=function(e){var n=this;n.assertIsNotDisposed();var r=n._source,i=r?r.length:0;return i&&(!e||t.prototype.any.call(this,e))},r.prototype.count=function(e){var n=this;n.assertIsNotDisposed();var r=n._source,i=r?r.length:0;return i&&(e?t.prototype.count.call(this,e):i)},r.prototype.elementAt=function(e){var n=this;n.assertIsNotDisposed();var r=n._source;return e<r.length&&e>=0?r[e]:t.prototype.elementAt.call(this,e)},r.prototype.elementAtOrDefault=function(e,t){t===void 0&&(t=null);var n=this;n.assertIsNotDisposed();var r=n._source;return e<r.length&&e>=0?r[e]:t},r.prototype.first=function(){var e=this;e.assertIsNotDisposed();var n=e._source;return n&&n.length?n[0]:t.prototype.first.call(this)},r.prototype.firstOrDefault=function(e){e===void 0&&(e=null);var t=this;t.assertIsNotDisposed();var n=t._source;return n&&n.length?n[0]:e},r.prototype.last=function(){var e=this;e.assertIsNotDisposed();var n=e._source,r=n.length;return r?n[r-1]:t.prototype.last.call(this)},r.prototype.lastOrDefault=function(e){e===void 0&&(e=null);var t=this;t.assertIsNotDisposed();var n=t._source,r=n.length;return r?n[r-1]:e},r.prototype.skip=function(t){var n=this;return!t||t<0?n.asEnumerable():new b(function(){return new e.Collections.ArrayEnumerator(function(){return n._source},t)})},r.prototype.takeExceptLast=function(e){e===void 0&&(e=1);var t=this,n=t._source?t._source.length:0;return t.take(n-e)},r.prototype.takeFromLast=function(e){if(!e||e<0)return b.empty();var t=this,n=t._source?t._source.length:0;return t.skip(n-e)},r.prototype.reverse=function(){var t=this;return new b(function(){return new e.Collections.ArrayEnumerator(function(){return t._source},t._source?t._source.length-1:0,-1)})},r.prototype.memoize=function(){return new r(this._source)},r.prototype.sequenceEqual=function(i,s){return s===void 0&&(s=e.areEqual),i instanceof Array?n.areEqual(this.source,i,!0,s):i instanceof r?i.sequenceEqual(this.source,s):t.prototype.sequenceEqual.call(this,i,s)},r.prototype.toJoinedString=function(e,n){e===void 0&&(e=""),n===void 0&&(n=c.Identity);var r=this._source;return!n&&r instanceof Array?r.join(e):t.prototype.toJoinedString.call(this,e,n)},r}(b);t.ArrayEnumerable=w;var E=function(t){function n(e,n){t.call(this,null),this.prevSource=e,this.prevPredicate=n}return __extends(n,t),n.prototype.where=function(e){if(e.length>1)return t.prototype.where.call(this,e);var r=this.prevPredicate,i=function(t){return r(t)&&e(t)};return new n(this.prevSource,i)},n.prototype.select=function(e){return e.length>1?t.prototype.select.call(this,e):new S(this.prevSource,this.prevPredicate,e)},n.prototype.getEnumerator=function(){var t=this.prevPredicate,n=this.prevSource,r;return new e.Collections.EnumeratorBase(function(){r=n.getEnumerator()},function(e){while(r.moveNext())if(t(r.current))return e.yieldReturn(r.current);return!1},function(){e.dispose(r)})},n.prototype._onDispose=function(){t.prototype._onDispose.call(this),this.prevPredicate=null,this.prevSource=null},n}(b);t.WhereEnumerable=E;var S=function(t){function n(e,n,r){t.call(this,null),this.prevSource=e,this.prevPredicate=n,this.prevSelector=r}return __extends(n,t),n.prototype.where=function(e){return e.length>1?t.prototype.where.call(this,e):new E(this,e)},n.prototype.select=function(e){if(e.length>1)return t.prototype.select.call(this,e);var r=this,i=r.prevSelector,s=function(t){return e(i(t))};return new n(r.prevSource,r.prevPredicate,s)},n.prototype.getEnumerator=function(){var t=this,n=t.prevPredicate,i=t.prevSource,s=t.prevSelector,o;return new r(function(){o=i.getEnumerator()},function(e){while(o.moveNext()){var t=o.current;if(n==null||n(t))return e.yieldReturn(s(t))}return!1},function(){e.dispose(o)})},n.prototype._onDispose=function(){var e=this;t.prototype._onDispose.call(this),e.prevPredicate=null,e.prevSource=null,e.prevSelector=null},n}(b);t.WhereSelectEnumerable=S;var x=function(t){function n(e,n,r,i){t.call(this,null),this.source=e,this.keySelector=n,this.descending=r,this.parent=i}return __extends(n,t),n.prototype.createOrderedEnumerable=function(e,t){return new n(this.source,e,t,this)},n.prototype.thenBy=function(e){return this.createOrderedEnumerable(e,!1)},n.prototype.thenByDescending=function(e){return this.createOrderedEnumerable(e,!0)},n.prototype.getEnumerator=function(){var t=this,n,r,i=h;return new e.Collections.EnumeratorBase(function(){i=h,n=[],r=[],b.forEach(t.source,function(e,t){n[t]=e,r[t]=t});var e=T.create(t);e.generateKeys(n),r.sort(function(t,n){return e.compare(t,n)})},function(e){return i<r.length?e.yieldReturn(n[r[i++]]):!1},function(){n&&(n.length=0),n=null,r&&(r.length=0),r=null})},n.prototype._onDispose=function(){t.prototype._onDispose.call(this),this.source=null,this.keySelector=null,this.descending=null,this.parent=null},n}(b);t.OrderedEnumerable=x;var T=function(){function t(e,t,n){this.keySelector=e,this.descending=t,this.child=n,this.keys=null}return t.create=function(e,n){n===void 0&&(n=null);var r=new t(e.keySelector,e.descending,n);return e.parent?t.create(e.parent,r):r},t.prototype.generateKeys=function(e){var t=this,n=e.length|0,r=t.keySelector,i=new Array(n);for(var s=h;s<n;++s)i[s]=r(e[s]);t.keys=i,t.child&&t.child.generateKeys(e)},t.prototype.compare=function(t,n){var r=this,i=r.keys,s=e.compare(i[t],i[n]);if(s==0){var o=r.child;return o?o.compare(t,n):e.compare(t,n)}return r.descending?-s:s},t}(),N=function(){function t(e){this._dictionary=e}return Object.defineProperty(t.prototype,"count",{get:function(){return this._dictionary.count},enumerable:!0,configurable:!0}),t.prototype.get=function(e){return this._dictionary.get(e)},t.prototype.contains=function(e){return this._dictionary.containsKey(e)},t.prototype.getEnumerator=function(){var t=this,n;return new e.Collections.EnumeratorBase(function(){n=t._dictionary.getEnumerator()},function(e){if(!n.moveNext())return!1;var t=n.current;return e.yieldReturn(new C(t.key,t.value))},function(){e.dispose(n)})},t}();t.Lookup=N;var C=function(e){function t(t,n){e.call(this,n),this._groupKey=t}return __extends(t,e),Object.defineProperty(t.prototype,"key",{get:function(){return this._groupKey},enumerable:!0,configurable:!0}),t}(w);t.Grouping=C})(t=e.Linq||(e.Linq={}))})(System||(System={})),define("System.Linq",["System"],function(e){return function(){var t,n;return t||e.System.Linq}}(this));
//# sourceMappingURL=../build/System.Linq.amd.js.map