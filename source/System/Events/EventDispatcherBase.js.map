{"version":3,"sources":["System/Events/EventDispatcherBase.ts"],"names":[],"mappings":"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","file":"System/Events/EventDispatcherBase.js","sourcesContent":["/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\n\r\nimport * as AU from \"../Collections/Array/Utility\";\r\nimport {shallowCopy} from \"../Utility/shallowCopy\";\r\nimport {DisposableBase} from \"../Disposable/DisposableBase\";\r\nimport {dispose} from \"../Disposable/dispose\";\r\nimport {IEventListener} from \"./IEventListener\";\r\nimport {EventDispatcherEntry} from \"./EventDispatcherEntry\";\r\nimport {IEventDispatcher} from \"./IEventDispatcher\";\r\nimport __extendsImport from \"../../extends\";\r\nconst __extends = __extendsImport;\r\n\r\nconst DISPOSING:string = 'disposing',\r\n      DISPOSED:string  = 'disposed';\r\n\r\n// The following interfaces are exported for sub class implementation.\r\n\r\nexport interface IEventBase<TTarget>\r\n{\r\n\ttype:string;\r\n\ttarget:TTarget;\r\n}\r\n\r\nexport interface IEvent extends IEventBase<any>\r\n{\r\n\r\n}\r\n\r\nexport interface IEntryParams\r\n{\r\n\tpriority:number;\r\n\tdispatcher:EventDispatcherBase;\r\n}\r\n\r\nfunction entryFinalizer()\r\n{\r\n\tvar p:IEntryParams = this.params;\r\n\tp.dispatcher.removeEntry(this);\r\n\tp.dispatcher = null;\r\n}\r\n\r\nexport default\r\nclass EventDispatcherBase extends DisposableBase implements IEventDispatcher\r\n{\r\n\r\n\tprotected _entries:EventDispatcherEntry<IEntryParams>[];\r\n\r\n\taddEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:IEventListener,\r\n\t\tpriority:number = 0):void\r\n\t{\r\n\t\tvar e = this._entries;\r\n\t\tif(!e) this._entries = e = [];\r\n\r\n\t\t// flash/vibe.js means of adding is indiscriminate and will double add listeners...\r\n\t\t// we can then avoid double adds by including a 'registerEventListener' method.\r\n\t\te.push(\r\n\t\t\tnew EventDispatcherEntry(type, listener, {\r\n\t\t\t\t\tpriority: priority || 0,\r\n\t\t\t\t\tdispatcher: this\r\n\t\t\t\t},\r\n\t\t\t\tentryFinalizer));\r\n\t}\r\n\r\n\tremoveEntry(entry:EventDispatcherEntry<IEntryParams>):boolean\r\n\t{\r\n\t\treturn !!this._entries && AU.remove(this._entries, entry)!=0;\r\n\t}\r\n\r\n\t// Allow for simple add once mechanism.\r\n\tregisterEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:IEventListener,\r\n\t\tpriority:number = 0):void//, useWeakReference: boolean= false)\r\n\t{\r\n\t\tif(!this.hasEventListener(type, listener))\r\n\t\t\tthis.addEventListener(type, listener, priority);\r\n\t}\r\n\r\n\thasEventListener(type:string, listener?:IEventListener):boolean\r\n\t{\r\n\t\tvar e = this._entries;\r\n\t\treturn e && e.some(\r\n\t\t\t\t(value:EventDispatcherEntry<IEntryParams>):boolean =>\r\n\t\t\t\ttype==value.type && (!listener || listener==value.listener)\r\n\t\t\t);\r\n\t}\r\n\r\n\tremoveEventListener(\r\n\t\ttype:string,\r\n\t\tlistener:IEventListener):void\r\n\t{\r\n\t\tdispose.these(this._entries.filter(entry=> entry.matches(type, listener)));\r\n\t}\r\n\r\n\tdispatchEvent(type:string, params?:any):boolean;\r\n\tdispatchEvent(event:IEvent):boolean;\r\n\tdispatchEvent(e:any, params?:any):boolean\r\n\t{\r\n\r\n\t\tvar _ = this, l = _._entries;\r\n\t\tif(!l || !l.length)\r\n\t\t\treturn false;\r\n\r\n\t\tvar event:IEventBase<any>;\r\n\r\n\t\tif(typeof e==\"string\")\r\n\t\t{\r\n\t\t\tevent = Event && Object.create(Event) || {};\r\n\t\t\tif(!params)\r\n\t\t\t\tparams = {};\r\n\t\t\tif(params['cancellable'])\r\n\t\t\t\t(<any>event).cancellable = true;\r\n\t\t\tevent.target = _;\r\n\t\t\tevent.type = e;\r\n\t\t}\r\n\t\telse\r\n\t\t\tevent = e;\r\n\r\n\t\tvar type = event.type;\r\n\r\n\t\t// noinspection JSMismatchedCollectionQueryUpdate\r\n\t\tvar entries:EventDispatcherEntry<IEntryParams>[] = l.filter(e=>e.type==type);//, propagate = true, prevent = false;\r\n\t\tif(!entries.length)\r\n\t\t\treturn false;\r\n\r\n\t\tentries.sort((a, b)=> b.params.priority - a.params.priority);\r\n\r\n\t\t// For now... Just use simple...\r\n\t\tentries.forEach(\r\n\t\t\tentry=>\r\n\t\t\t{\r\n\t\t\t\tvar newEvent = Object.create(Event);\r\n\t\t\t\tshallowCopy(event, newEvent);\r\n\t\t\t\tnewEvent.target = this;\r\n\t\t\t\tentry.dispatch(newEvent);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tstatic get DISPOSING() { return DISPOSING; }\r\n\r\n\tstatic get DISPOSED() { return DISPOSED; }\r\n\r\n\t// When dispatching events, we need a way to prevent recursion when disposing.\r\n\tprivate _isDisposing:boolean = false;\r\n\tget isDisposing():boolean\r\n\t{\r\n\t\treturn this._isDisposing;\r\n\t}\r\n\r\n\t// Override the public method here since EventDispatcher will end up doing things a bit differently from here on.\r\n\tpublic dispose()\r\n\t{\r\n\r\n\t\t// Having a disposing event can allow for child objects to automatically release themselves when their parent is disposed.\r\n\t\tvar _ = this;\r\n\t\tif(!_.wasDisposed && !_._isDisposing)\r\n\t\t{\r\n\t\t\t_._isDisposing = true;\r\n\t\t\t_.dispatchEvent(DISPOSING);\r\n\r\n\t\t\tsuper.dispose();\r\n\r\n\t\t\t_.dispatchEvent(DISPOSED);\r\n\r\n\t\t\tvar l = _._entries;\r\n\t\t\tif(l)\r\n\t\t\t{\r\n\t\t\t\tthis._entries = null;\r\n\t\t\t\tl.forEach(e=> e.dispose());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\n"]}